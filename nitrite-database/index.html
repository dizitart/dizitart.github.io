<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="description" content="Nitrite database is an open source Nosql embedded persistent document store written in Java. It has MongoDB like API. It supports both in-memory and single file based persistent store powered by MVStore engine of h2 database. Nitrite can be used in desktop as well as mobile applications like android.">
<meta name="keywords" content="nitrite, nosql, embedded, embedded document store, android, android nosql database, java, key value store, document store, object store, persistent store, index, indexing, fulltext search, embedded mongo,">
<meta name="author" content="Anindya Chatterjee">
<title>Nitrite</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<!--
  ~
  ~ Copyright 2017-2018 Nitrite author or authors.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
  -->

<script>
    var SeedAndDewConfig = {};
    (function() {
        SeedAndDewConfig['adClass'] = "snd-ad";
        /* * * DON'T EDIT BELOW THIS LINE * * */
        SeedAndDewConfig['projectId'] = '6bc6cfa1-f85f-44a3-a43e-28444b0ea5e5';
        SeedAndDewConfig['loadStartTime'] = performance.now();
        SeedAndDewConfig['apiVersion'] = '2018-05-28'
        SeedAndDewConfig['sessionId'] = Math.random().toString(36).substring(2, 15);
        var snd = document.createElement('script');
        snd.type = 'text/javascript';
        snd.async = true;
        snd.src = 'https://www.seedanddew.com/static/embed.min.js';
        (document.getElementsByTagName('head')[0] ||
            document.getElementsByTagName('body')[0]).appendChild(snd);
    })();
</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Nitrite</h1>
<div class="details">
<span id="author" class="author">Anindya Chatterjee</span><br>
<span id="email" class="email"><a href="mailto:anindya@dizitart.com">anindya@dizitart.com</a></span><br>
<span id="revnumber">version 3.4.2,</span>
<span id="revdate">2020-06-02 20:47:45 IST</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#what-is-nitrite">1. What Is Nitrite?</a></li>
<li><a href="#what-it-is-not">2. What It Is Not?</a></li>
<li><a href="#getting-started">3. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#how-to-install">3.1. How To Install</a></li>
<li><a href="#quick-examples">3.2. Quick Examples</a></li>
</ul>
</li>
<li><a href="#nitrite-database">4. Nitrite Database</a>
<ul class="sectlevel2">
<li><a href="#create-open-database">4.1. Create/Open Database</a>
<ul class="sectlevel3">
<li><a href="#security">4.1.1. Security</a></li>
</ul>
</li>
<li><a href="#close-database">4.2. Close Database</a></li>
<li><a href="#create-open-collections">4.3. Create/Open Collections</a></li>
<li><a href="#commit">4.4. Commit</a></li>
<li><a href="#compaction">4.5. Compaction</a></li>
</ul>
</li>
<li><a href="#document">5. Document</a></li>
<li><a href="#nitriteid">6. NitriteId</a></li>
<li><a href="#collections">7. Collections</a>
<ul class="sectlevel2">
<li><a href="#nitritecollection">7.1. NitriteCollection</a></li>
<li><a href="#objectrepository">7.2. ObjectRepository</a>
<ul class="sectlevel3">
<li><a href="#annotations">7.2.1. Annotations</a></li>
<li><a href="#nitritemapper">7.2.2. NitriteMapper</a></li>
<li><a href="#mappable">7.2.3. Mappable</a></li>
</ul>
</li>
<li><a href="#operations">7.3. Operations</a></li>
<li><a href="#crud-operations">7.4. CRUD Operations</a>
<ul class="sectlevel3">
<li><a href="#writeresult">7.4.1. WriteResult</a></li>
<li><a href="#insert">7.4.2. Insert</a></li>
<li><a href="#update">7.4.3. Update</a></li>
<li><a href="#remove">7.4.4. Remove</a></li>
<li><a href="#find">7.4.5. Find</a></li>
<li><a href="#projection">7.4.6. Projection</a></li>
<li><a href="#join">7.4.7. Join</a></li>
</ul>
</li>
<li><a href="#events">7.5. Events</a></li>
<li><a href="#indexing">7.6. Indexing</a>
<ul class="sectlevel3">
<li><a href="#text-index">7.6.1. Text Index</a></li>
<li><a href="#index-annotations">7.6.2. Index Annotations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#filter">8. Filter</a>
<ul class="sectlevel2">
<li><a href="#examples">8.1. Examples</a></li>
</ul>
</li>
<li><a href="#replication">9. Replication</a>
<ul class="sectlevel2">
<li><a href="#security-2">9.1. Security</a></li>
<li><a href="#synchandle">9.2. SyncHandle</a></li>
<li><a href="#algorithm">9.3. Algorithm</a></li>
</ul>
</li>
<li><a href="#under-the-hood">10. Under The Hood</a>
<ul class="sectlevel2">
<li><a href="#nitritestore">10.1. NitriteStore</a></li>
<li><a href="#nitritemap">10.2. NitriteMap</a></li>
</ul>
</li>
<li><a href="#tools">11. Tools</a>
<ul class="sectlevel2">
<li><a href="#data-exchange">11.1. Data Exchange</a>
<ul class="sectlevel3">
<li><a href="#data-format">11.1.1. Data Format</a></li>
</ul>
</li>
<li><a href="#recovery">11.2. Recovery</a></li>
<li><a href="#datagate">11.3. DataGate</a></li>
</ul>
</li>
<li><a href="#potassium-nitrite">12. Potassium Nitrite</a>
<ul class="sectlevel2">
<li><a href="#initialization">12.1. Initialization</a></li>
<li><a href="#filters">12.2. Filters</a></li>
<li><a href="#others">12.3. Others</a></li>
<li><a href="#kotlin-data-class">12.4. Kotlin Data Class</a></li>
<li><a href="#tips">12.5. Tips</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/nitrite-logo.svg" alt="Logo 200" width="200">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-is-nitrite">1. What Is Nitrite?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>NO</strong>sql <strong>O</strong>bject (<strong>NO<sub>2</sub></strong> a.k.a Nitrite) database is an open source nosql embedded
document store written in Java. It has MongoDB like API. It supports both
in-memory and single file based persistent store powered by
<a href="http://www.h2database.com/html/mvstore.html">MVStore</a> engine of h2 database.</p>
</div>
<div class="paragraph">
<p>Nitrite is a server-less embedded database ideal for desktop, mobile or small web applications.</p>
</div>
<div class="paragraph">
<p><strong>It features</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Embedded key-value/document and object store</p>
</li>
<li>
<p>In-memory (on/off)-heap store</p>
</li>
<li>
<p>Single file store</p>
</li>
<li>
<p>Very fast and lightweight MongoDB like API</p>
</li>
<li>
<p>Indexing</p>
</li>
<li>
<p>Full text search capability</p>
</li>
<li>
<p>Full Android compatibility (API Level 19)</p>
</li>
<li>
<p>Observable store</p>
</li>
<li>
<p>Both way replication via Nitrite DataGate server</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-it-is-not">2. What It Is Not?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nitrite is not an RDBMS. It is also not a distributed nosql database like MongoDB or Cassandra. It does not have
any server for external application to connect to. It does not support sharding and ACID transaction.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">3. Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="how-to-install">3.1. How To Install</h3>
<div class="paragraph">
<p>To use Nitrite in any Java application, just add the below dependency:</p>
</div>
<div class="paragraph">
<p><strong>Maven</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.dizitart<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>nitrite<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.4.2<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Gradle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.dizitart:nitrite:3.4.2</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="quick-examples">3.2. Quick Examples</h3>
<div class="listingblock">
<div class="title">Initialize Database</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// java initialization</span>
Nitrite db = Nitrite.builder()
        .compressed()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// android initialization</span>
Nitrite db = Nitrite.builder()
        .compressed()
        .filePath(getFilesDir().getPath() + <span class="string"><span class="delimiter">&quot;</span><span class="content">/test.db</span><span class="delimiter">&quot;</span></span>)
        .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more options on opening a database visit <a href="#create-open-database">here</a>.</p>
</div>
<div class="listingblock">
<div class="title">Create a Collection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a Nitrite Collection</span>
NitriteCollection collection = db.getCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Create an Object Repository</span>
ObjectRepository&lt;Employee&gt; repository = db.getRepository(Employee.class);

<span class="comment">// Create an Object Repository with a key</span>
ObjectRepository&lt;Employee&gt; repository = db.getRepository(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, Employee.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">CRUD Operations</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create a document to populate data</span>
<span class="predefined-type">Document</span> doc = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="type">byte</span><span class="type">[]</span> {<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>})
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">fruits</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;() {{ add(<span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">banana</span><span class="delimiter">&quot;</span></span>); }})
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">note</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a quick brown fox jump over the lazy dog</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// insert the document</span>
collection.insert(doc);

<span class="comment">// update the document</span>
collection.update(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>), createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Wick</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// remove the document</span>
collection.remove(doc);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// insert an object</span>
Employee emp = <span class="keyword">new</span> Employee();
emp.setEmpId(<span class="integer">124589</span>);
emp.setFirstName(<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>);
emp.setLastName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>);

repository.insert(emp);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Details of CRUD operations for Nitrite Collection are <a href="#crud-operations">here</a>, and
for Object Repository are <a href="#crud-operations-2">here</a>.</p>
</div>
<div class="listingblock">
<div class="title">Create Indices</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create document index</span>
collection.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, indexOptions(IndexType.NonUnique));
collection.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">note</span><span class="delimiter">&quot;</span></span>, indexOptions(IndexType.Fulltext));

<span class="comment">// create object index</span>
repository.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, indexOptions(IndexType.NonUnique));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on Index operations, see <a href="#indexing">here</a> and <a href="#indexing-2">here</a>.</p>
</div>
<div class="listingblock">
<div class="title">Query a Collection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Cursor</span> cursor = collection.find(
                        <span class="comment">// and clause</span>
                        and(
                            <span class="comment">// firstName == John</span>
                            eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>),
                            <span class="comment">// elements of data array is less than 4</span>
                            elemMatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, lt(<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span>)),
                            <span class="comment">// elements of fruits list has one element matching orange</span>
                            elemMatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">fruits</span><span class="delimiter">&quot;</span></span>, regex(<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>)),
                            <span class="comment">// note field contains string 'quick' using full-text index</span>
                            text(<span class="string"><span class="delimiter">&quot;</span><span class="content">note</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">quick</span><span class="delimiter">&quot;</span></span>)
                            )
                        );

<span class="keyword">for</span> (<span class="predefined-type">Document</span> document : cursor) {
    <span class="comment">// process the document</span>
}

<span class="comment">// create document by id</span>
<span class="predefined-type">Document</span> document = collection.getById(nitriteId);

<span class="comment">// query an object repository and create the first result</span>
Employee emp = repository.find(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>))
                         .firstOrDefault();</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several find filters available for feature-rich search operations. Please head over
<a href="#filter">here</a>.</p>
</div>
<div class="listingblock">
<div class="title">Automatic Replication</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// connect to a DataGate server localhost 9090 port</span>
DataGateClient dataGateClient = <span class="keyword">new</span> DataGateClient(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:9090</span><span class="delimiter">&quot;</span></span>)
        .withAuth(<span class="string"><span class="delimiter">&quot;</span><span class="content">userId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);
DataGateSyncTemplate syncTemplate
        = <span class="keyword">new</span> DataGateSyncTemplate(dataGateClient, <span class="string"><span class="delimiter">&quot;</span><span class="content">remote-collection@userId</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// create sync handle</span>
SyncHandle syncHandle = Replicator.of(db)
        .forLocal(collection)
        <span class="comment">// a DataGate sync template implementation</span>
        .withSyncTemplate(syncTemplate)
        <span class="comment">// replication attempt delay of 1 sec</span>
        .delay(timeSpan(<span class="integer">1</span>, <span class="predefined-type">TimeUnit</span>.SECONDS))
        <span class="comment">// both-way replication</span>
        .ofType(ReplicationType.BOTH_WAY)
        <span class="comment">// sync event listener</span>
        .withListener(<span class="keyword">new</span> SyncEventListener() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onSyncEvent(SyncEventData eventInfo) {

            }
        })
        .configure();

<span class="comment">// start sync in the background using handle</span>
syncHandle.startSync();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import/Export Data</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Export data to a file</span>
Exporter exporter = Exporter.of(db);
exporter.exportTo(schemaFile);

<span class="comment">//Import data from the file</span>
Importer importer = Importer.of(db);
importer.importFrom(schemaFile);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For any detail information or when in doubt please consult the <a href="http://javadoc.io/doc/org.dizitart/nitrite/">javadoc</a>.
This is not one of those plain old vanilla javadoc, it is heavily attributed with lots of example and gotchas.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Click the <span class="icon"><i class="fa fa-file-code-o"></i></span> icon next to a class name in the document to go directly to corresponding javadoc.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="nitrite-database">4. Nitrite Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Nitrite
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/Nitrite.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
class provides several methods to create, query, close or compact a nitrite
database.</p>
</div>
<div class="sect2">
<h3 id="create-open-database">4.1. Create/Open Database</h3>
<div class="paragraph">
<p>A nitrite database can only be created and opened by NitriteBuilder
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/NitriteBuilder.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span> utility.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NitriteBuilder builder = Nitrite.builder();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create a file based database</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a file path is provided and the file does not exists, builder will create a new file
based database. If the file exists, builder will try to open the existing database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the existing database file is corrupted, while opening, nitrite will try to recover
from it by restoring the last known good version.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Create an in-memory database</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .openOrCreate();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create an in-memory database with off-heap storage</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .enableOffHeapStorage()
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no file path is provided, builder will create an in-memory database.</p>
</div>
<div class="listingblock">
<div class="title">Disable auto commit</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .disableAutoCommit()
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default auto-commit is enabled while creating nitrite database. But it can be disabled also.</p>
</div>
<div class="listingblock">
<div class="title">Change auto commit buffer size</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .autoCommitBufferSize(<span class="integer">2048</span>) <span class="comment">// size is 2048 KB now</span>
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If auto commit is not disabled, nitrite will commit the changes if the size of unsaved
changes is more than the write buffer size. By default the buffer size is 1024 KB. But
it can be customized also from builder.</p>
</div>
<div class="listingblock">
<div class="title">Disable auto compaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .disableAutoCompact()
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nitrite by default compacts the database file before close. If compaction is enabled
chunks will be moved next to each other. Disabling compaction will increase the
performance during database close.</p>
</div>
<div class="listingblock">
<div class="title">Open database in read only mode</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .readOnly()
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The builder can also open a database in readonly mode. While opened in readonly mode
nitrite will not persists any changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While opened in readonly mode, options like <code>autoCommitBufferSize(size)</code>,
<code>compressed()</code> or <code>disableAutoCommit()</code> do not have any effect.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Enable compression</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .compressed()
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>A nitrite database can be compressed while saving the changes to the disk. The compression
algorithm nitrite uses is LZF. This will save about 50% of the disk space, but it will
slow down read and write operations slightly.</p>
</div>
<div class="listingblock">
<div class="title">Specify a custom full-text engine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .textIndexingService(<span class="keyword">new</span> MyTextIndexingEngine())
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nitrite also provides some options for full-text indexing. Nitrite has its own
full-text indexing engine, but there is a provision to supply third-party full-text
engine implementation like lucene.</p>
</div>
<div class="listingblock">
<div class="title">Specify a custom text tokenizer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .textTokenizer(<span class="keyword">new</span> MyBengaliTextTokenizer())
        .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nitrite&#8217;s own full-text index engine is for english language only. But if anyone
wants to use the same engine for languages other than english, a custom <code>TextTokenizer</code>
implementation for that language should be configured in the builder.</p>
</div>
<div class="paragraph">
<p>Once a database is opened it acquires an exclusive lock to the data file. So if
a database is opened in a process, further attempt to open it from another process
will fail. Proper closing of a database will release the file lock.</p>
</div>
<div class="paragraph">
<p>While opening the database, nitrite registers itself to a JVM shutdown hook, which
before exiting will close the database without persisting any unsaved changes to the
disk. This shutdown hook protects the data file from corruption due to JVM shutdown
before properly closing the database.</p>
</div>
<div class="sect3">
<h4 id="security">4.1.1. Security</h4>
<div class="paragraph">
<p>A nitrite database can be secured using a username password pair. The username and password can be set
only once while creating the database. Nitrite does not store raw password, so retrieval or change of
password is not possible. Adding a new username password pair is also not possible for existing database.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
        .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
        .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Nitrite does not support access control.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="close-database">4.2. Close Database</h3>
<div class="paragraph">
<p>A nitrite database should be closed before exiting from the program.
When a database is opened, it acquires an exclusive lock to the data file.
Closing a database releases the lock. Prior to closing, nitrite will persists
all unsaved changes to the disk and compacts the data file by moving all
chunks next to each other.</p>
</div>
<div class="paragraph">
<p>To close a database call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">db.close();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Once a database is closed, no further operation is possible on the instance
with out properly opening it again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To check if a database is already closed, use below method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">db.isClosed();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-open-collections">4.3. Create/Open Collections</h3>
<div class="paragraph">
<p>To create or open a NitriteCollection call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NitriteCollection collection = db.getCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">collectionName</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no collection exists with the name in the database, a new
collection with the given name will be created. But if there is
already a collection with the same name in the database, it will
be opened.</p>
</div>
<div class="paragraph">
<p>Similarly, to create or open an ObjectRepository call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// creates an object repository of type Employee</span>
ObjectRepository&lt;Employee&gt; repository = db.getRepository(Employee.class);

<span class="comment">// creates an object repository of type Employee with a specified key</span>
ObjectRepository&lt;Employee&gt; repository = db.getRepository(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, Employee.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no object repository of the given type exists in the database, a new
one will be created; otherwise the existing one will be opened.</p>
</div>
</div>
<div class="sect2">
<h3 id="commit">4.4. Commit</h3>
<div class="paragraph">
<p>To persists unsaved data to the disk call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">db.commit();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
No need to call this method after every change, if auto-commit
is enabled while opening the db. However, it may still be called to
flush all changes to disk.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To check if a nitrite database has any unsaved changes which has
not been committed yet, use below method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> unsaved = db.hasUnsavedChanges();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compaction">4.5. Compaction</h3>
<div class="paragraph">
<p>The nitrite data file can be compacted using below method. Compaction
is done by moving all chunks next to each other.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">db.compact();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default auto compaction is enabled. It compacts the database before
close.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document">5. Document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nitrite stores data as Documents
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/Document.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
which are JSON-like field and value pairs. Document is a schema-less data structure and it can store any arbitrary java object.</p>
</div>
<div class="listingblock">
<div class="title">Example of a document:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Document</span> doc = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="type">byte</span><span class="type">[]</span> {<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>})
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">fruits</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;() {{ add(<span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">banana</span><span class="delimiter">&quot;</span></span>); }})
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">note</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a quick brown fox jump over the lazy dog</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A document field:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is case sensitive</p>
</li>
<li>
<p>does not allow duplicates</p>
</li>
<li>
<p>can not be <code>null</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A document value:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>can be any java type</p>
</li>
<li>
<p>can be another document</p>
</li>
<li>
<p>can be <code>null</code> except '_id' field&#8217;s value</p>
</li>
<li>
<p>if indexed, it&#8217;s java type should be primitive or implement java.lang.Comparable</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A document can directly be constructed from JSON string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MapperFacade facade = <span class="keyword">new</span> JacksonFacade();
<span class="predefined-type">Document</span> doc = facade.parse(jsonString);</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="nitriteid">6. NitriteId</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A unique identifier across a nitrite database. Each document in a NitriteCollection is associated
with a unique NitriteId <span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/NitriteId.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>.</p>
</div>
<div class="paragraph">
<p>During insertion of a document, nitrite will generate a new NitriteId and put its value in the
'_id' field of the document.</p>
</div>
<div class="listingblock">
<div class="title">Example for custom id</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create a document</span>
<span class="predefined-type">Document</span> docu = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// insert the document in the collection</span>
WriteResult writeResult = collection.insert(docu);
NitriteId nitriteId = Iterables.firstOrDefault(writeResult);

<span class="comment">// assert that document now has _id field populated</span>
assertEquals(nitriteId, docu.getId());
assertEquals(docu.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">_id</span><span class="delimiter">&quot;</span></span>), nitriteId.getIdValue());</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="collections">7. Collections</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nitrite supports two types of collections</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NitriteCollection - for storing Documents</p>
</li>
<li>
<p>ObjectRepository - for storing java objects</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="nitritecollection">7.1. NitriteCollection</h3>
<div class="paragraph">
<p>Nitrite stores documents into NitriteCollection
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/NitriteCollection.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>.
NitriteCollection are analogous to a table in RDBMS. A NitriteCollection is constructed using a NitriteMap
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/store/NitriteMap.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
which internally maintains a counted B+ tree to store documents.</p>
</div>
<div class="paragraph">
<p>Index can be created on a NitriteCollection for faster retrieval.</p>
</div>
<div class="paragraph">
<p>Each NitriteCollection has a unique name across the database to identify it uniquely. It can be created or
opened by its name only. <code>db.getCollection(String name)</code> call opens a NitriteCollection from the database. But if
it does not exist, it will be created and returned.</p>
</div>
<div class="paragraph">
<p>A NitriteCollection is observable. Any modification to it can be listened to by an implementation of <code>ChangeListener</code>
interface. Each operation raises different events like INSERT, UPDATE, REMOVE etc.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
NitriteCollection is thread-safe for concurrent use.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of NitriteCollection:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create/open a collection named - test</span>
NitriteCollection collection = db.getCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// observe any change to the collection</span>
collection.register(<span class="keyword">new</span> <span class="predefined-type">ChangeListener</span>() {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onChange(ChangeInfo changeInfo) {
        <span class="comment">// your logic based on action</span>
    }
});

<span class="predefined-type">Document</span> doc = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>())
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="type">byte</span><span class="type">[]</span> {<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>})
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">fruits</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;() {{ add(<span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">orange</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">banana</span><span class="delimiter">&quot;</span></span>); }})
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">note</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a quick brown fox jump over the lazy dog</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// insert a document into the collection</span>
collection.insert(doc);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="objectrepository">7.2. ObjectRepository</h3>
<div class="paragraph">
<p>Along with NitriteCollection, nitrite also supports ObjectRepository
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/objects/ObjectRepository.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>.
It is a persistent generic collection of POJO classes. Internally it is backed by a NitriteCollection, where an object
is converted into a Document and then stored.</p>
</div>
<div class="paragraph">
<p>An ObjectRepository also supports the same set of operations that NitriteCollection supports. It is also observable and
tread-safe for concurrent use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ObjectRepository does not allow <code>null</code> or empty string as an id value.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of ObjectRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// create/open a database</span>
Nitrite db = Nitrite.builder()
    .compressed()
    .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// create an object repository</span>
ObjectRepository&lt;Employee&gt; employeeStore = db.getRepository(Employee.class);

<span class="comment">// observe any change to the repository</span>
employeeStore.register(<span class="keyword">new</span> <span class="predefined-type">ChangeListener</span>() {
     <span class="annotation">@Override</span>
     <span class="directive">public</span> <span class="type">void</span> onChange(ChangeInfo changeInfo) {
          <span class="comment">// your logic based on action</span>
     }
});

<span class="comment">// initialize an employee object</span>
Employee emp = <span class="keyword">new</span> Employee();
emp.setEmpId(<span class="integer">20365</span>);
emp.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>);
emp.setJoinDate(<span class="keyword">new</span> <span class="predefined-type">Date</span>());

<span class="comment">// insert the employee object</span>
employeeStore.insert(emp);

<span class="comment">// Employee class</span>
<span class="annotation">@Indices</span>({
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">joinDate</span><span class="delimiter">&quot;</span></span>, type = IndexType.NonUnique),
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, type = IndexType.Unique)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="type">long</span> empId;

    <span class="directive">private</span> <span class="predefined-type">Date</span> joinDate;

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="comment">// ... public getters and setters</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
ObjectRepository is thread-safe for concurrent use.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="annotations">7.2.1. Annotations</h4>
<div class="paragraph">
<p>Nitrite provides a set of annotations for entity objects while using it in ObjectRepository. The
annotations are to let Nitrite knows about various information about the ObjectRepository while
constructing it. It also helps to reduce some boilerplate code.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Employee class</span>
<span class="annotation">@Indices</span>({
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">joinDate</span><span class="delimiter">&quot;</span></span>, type = IndexType.NonUnique),
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, type = IndexType.Unique)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="type">long</span> empId;

    <span class="directive">private</span> <span class="predefined-type">Date</span> joinDate;

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">private</span> <span class="predefined-type">String</span> address;

    <span class="comment">// ... public getters and setters</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Index</code> annotation is to let Nitrite knows about the field which will be indexed. <code>Id</code> annotation
is to mark a field as id field. This id field is used to uniquely identify an object inside an
ObjectRepository. More on these annotations will be discussed later.</p>
</div>
</div>
<div class="sect3">
<h4 id="nitritemapper">7.2.2. NitriteMapper</h4>
<div class="paragraph">
<p>Nitrite converts java objects to Document before storing it in an ObjectRepository and similarly converts the Document
back to POJO while retrieving. The conversion is seamless for the end users. This conversion is managed by a NitriteMapper
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/mapper/NitriteMapper.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
implementation. By default NitriteMapper uses Jackson to convert POJO to a field-value map, but a custom
implementation can be set via NitriteBuilder.</p>
</div>
<div class="listingblock">
<div class="title">Example for setting a custom NitriteMapper</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
            .nitriteMapper(<span class="keyword">new</span> GSONMapper())        <span class="comment">// custom NitriteMapper</span>
            .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
            .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default NitriteMapper:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>does not allow circular reference (will throw ObjectMappingException)</p>
</li>
<li>
<p>needs POJO classes to have a public parameter-less constructor</p>
</li>
<li>
<p>honors fields declared as <code>transient</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As of 3.1.0, a jackson module can be easily registered with the default jackson mapper using
the builder.</p>
</div>
<div class="listingblock">
<div class="title">Example for registering jackson module</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Nitrite db = Nitrite.builder()
            .registerModule(<span class="keyword">new</span> Jdk8Module())        <span class="comment">// register jdk8 module</span>
            .registerModule(<span class="keyword">new</span> JavaTimeModule())    <span class="comment">// register java.time module</span>
            .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
            .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mappable">7.2.3. Mappable</h4>
<div class="paragraph">
<p>NitriteMapper relies on third-party serialization libraries for Document
serialization. Those libraries heavily depend on reflection, but
reflection has its toll. In environment like Android use of reflection
degrades the performance drastically. To bypass this overhead, Nitrite
provides a mechanism called Mappable
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/mapper/Mappable.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
interface.</p>
</div>
<div class="paragraph">
<p>If an object is <code>Mappable</code>, Nitrite will use the implementation
to convert the object to a Document and vice versa thus bypass the reflection
overhead.</p>
</div>
<div class="listingblock">
<div class="title">Example for Mappable</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> Mappable {
    <span class="directive">private</span> <span class="predefined-type">String</span> empId;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">Date</span> joiningDate;
    <span class="directive">private</span> Employee boss;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Document</span> write(NitriteMapper mapper) {
        <span class="predefined-type">Document</span> document = <span class="keyword">new</span> <span class="predefined-type">Document</span>();
        document.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">empId</span><span class="delimiter">&quot;</span></span>, getEmpId());
        document.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, getName());
        document.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">joiningDate</span><span class="delimiter">&quot;</span></span>, getJoiningDate());

        <span class="keyword">if</span> (getBoss() != <span class="predefined-constant">null</span>) {
            <span class="predefined-type">Document</span> bossDoc = getBoss().write(mapper);
            document.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">boss</span><span class="delimiter">&quot;</span></span>, bossDoc);
        }
        <span class="keyword">return</span> document;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> read(NitriteMapper mapper, <span class="predefined-type">Document</span> document) {
        <span class="keyword">if</span> (document != <span class="predefined-constant">null</span>) {
            setEmpId((<span class="predefined-type">String</span>) document.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">empId</span><span class="delimiter">&quot;</span></span>));
            setName((<span class="predefined-type">String</span>) document.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
            setJoiningDate((<span class="predefined-type">Date</span>) document.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">joiningDate</span><span class="delimiter">&quot;</span></span>));

            <span class="predefined-type">Document</span> bossDoc = (<span class="predefined-type">Document</span>) document.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">boss</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">if</span> (bossDoc != <span class="predefined-constant">null</span>) {
                Employee bossEmp = <span class="keyword">new</span> Employee();
                bossEmp.read(mapper, bossDoc);
                setBoss(bossEmp);
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operations">7.3. Operations</h3>
<div class="paragraph">
<p>Collection supports usual CRUD operations and indexing operations which will be discussed in details
in coming sections. Apart from these it supports other operations also.</p>
</div>
<div class="paragraph">
<p><strong>Drop</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">collection.drop();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It drops the <code>collection</code> and all of it indices associated with it. Any further
access to a dropped collection would result into an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> isDropped = collection.isDropped();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above code checks if a collection has already been dropped or not.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>drop()</code> operation raises a <strong>DROP</strong> event.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Close</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">collection.close();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It closes the <code>collection</code> for further access. If a NitriteCollection
is closed once, it can only be opened from a nitrite instance. Any
access to a closed collection would result into an error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> isClosed = collection.isClosed();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code checks if the <code>collection</code> is already closed or not.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>close()</code> operation raises a <strong>CLOSE</strong> event.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="crud-operations">7.4. CRUD Operations</h3>
<div class="paragraph">
<p>CRUD operations create, read, update, and delete documents/objects in collections.</p>
</div>
<div class="sect3">
<h4 id="writeresult">7.4.1. WriteResult</h4>
<div class="paragraph">
<p>Each modify operation returns a WriteResult
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/WriteResult.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>.
It represents the result of a modification operation in a
collection. It is also an iterable constructs which iterates
over all affected NitriteIds.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult result = collection.insert(doc1, doc2, doc3);

<span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Affected counts - </span><span class="delimiter">&quot;</span></span> + result.getAffectedCount());

<span class="keyword">for</span> (NitriteId id : result) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + id);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="insert">7.4.2. Insert</h4>
<div class="paragraph">
<p>Create or insert operations add new documents/objects to a collection.</p>
</div>
<div class="paragraph">
<p><strong>_id Field</strong></p>
</div>
<div class="paragraph">
<p>In nitrite, each document stored in a collection requires a unique '_id' field that acts as a primary key
and helps to identify a document within a collection. During insertion, nitrite generates a new and unique
NitriteId for every document and saves the value of the NitriteId into the '_id' field of the documentation.</p>
</div>
<div class="paragraph">
<p><strong>@Id Annotation</strong></p>
</div>
<div class="paragraph">
<p>Each object in an ObjectRepository can be uniquely identified by a field marked with <code>@Id</code> annotation. Nitrite
maintains an unique index on that field to identify the objects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Id field of an object does not have any direct relation with the <code>_id</code> field of the underlying Document.</p>
</div>
<div class="paragraph">
<p>But one can retrieve the corresponding NitriteId for an object like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyType</span> {

    <span class="annotation">@Id</span>
    <span class="directive">private</span> NitriteId idField;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Create operations for NitriteCollection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult insert(<span class="predefined-type">Document</span> document, <span class="predefined-type">Document</span>... documents)
WriteResult insert(<span class="predefined-type">Document</span><span class="type">[]</span> documents)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create operations for ObjectRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult insert(T object, T... others)
WriteResult insert(T<span class="type">[]</span> objects)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// insert one document</span>
collection.insert(doc1);

<span class="comment">// insert multiple documents</span>
collection.insert(doc1, doc2, doc3);

<span class="comment">// another way to insert multiple documents</span>
<span class="predefined-type">Document</span><span class="type">[]</span> documents = <span class="keyword">new</span> <span class="predefined-type">Document</span><span class="type">[]</span> {doc1, doc2, doc3};
collection.insert(documents);


<span class="comment">// create employee object</span>
Employee emp1 = <span class="keyword">new</span> Employee();
emp1.setEmpNumber(<span class="integer">12548</span>);
emp1.setEmpName(<span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// insert employee object</span>
repository.insert(emp1);

<span class="comment">// insert multiple employee objects</span>
repository.insert(emp1, emp2, emp3);

<span class="comment">// another way to insert multiple objects</span>
Employee<span class="type">[]</span> employees = <span class="keyword">new</span> Employee<span class="type">[]</span> {emp1, emp2, emp3};
repository.insert(employees);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Error Scenario</strong></p>
</div>
<div class="paragraph">
<p>Insertion operation will result in an error if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>document/object is <code>null</code></p>
</li>
<li>
<p>a field of the document is indexed and it violates
the unique constraint in the collection(if any).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An insert operation raises an <strong>INSERT</strong> event.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="update">7.4.3. Update</h4>
<div class="paragraph">
<p>Update operations modify documents/objects in a collection.</p>
</div>
<div class="listingblock">
<div class="title">Update operations for NitriteCollection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult update(<span class="predefined-type">Document</span> update)
WriteResult update(<span class="predefined-type">Document</span> update, <span class="type">boolean</span> upsert)
WriteResult update(<span class="predefined-type">Filter</span> filter, <span class="predefined-type">Document</span> update)
WriteResult update(<span class="predefined-type">Filter</span> filter, <span class="predefined-type">Document</span> update, UpdateOptions updateOptions)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Update operations for ObjectRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult update(T element)
WriteResult update(T element, <span class="type">boolean</span> upsert)
WriteResult update(ObjectFilter filter, T update)
WriteResult update(ObjectFilter filter, T update, <span class="type">boolean</span> upsert)
WriteResult update(ObjectFilter filter, <span class="predefined-type">Document</span> update)
WriteResult update(ObjectFilter filter, <span class="predefined-type">Document</span> update, <span class="type">boolean</span> justOnce)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>filter</code> is <code>null</code>, it will update all elements in the collection.</p>
</div>
<div class="paragraph">
<p><strong>Update one element</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult update(<span class="predefined-type">Document</span> document)
WriteResult update(T object)</code></pre>
</div>
</div>
<div class="paragraph">
<p>It updates a single element in the collection. The <code>object</code> must have
a field marked with <code>@Id</code> annotation.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Employee emp = <span class="keyword">new</span> Employee();
emp.setEmpId(<span class="integer">12564</span>);
emp.setAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">12 Some Street</span><span class="delimiter">&quot;</span></span>);
employeeRepository.insert(emp);

<span class="comment">// update object</span>
emp.setAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">25 New Street</span><span class="delimiter">&quot;</span></span>);
employeeRepository.update(emp);



<span class="predefined-type">Document</span> doc = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
                    .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>);
NitriteId nitriteId = doc.getId();
collection.insert(doc);

<span class="comment">// update the document</span>
<span class="predefined-type">Document</span> document = collection.getById(nitriteId);
document.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">31</span>);

collection.update(document);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Update with Upsert</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult update(<span class="predefined-type">Document</span> update, <span class="type">boolean</span> upsert)
WriteResult update(T object, <span class="type">boolean</span> upsert)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specified element must have an id. If the element is not found in the
collection, it will be inserted only if upsert option is set to <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">emp.setAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">25 New Street</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// if emp object is not there in repository, it will be inserted</span>
employeeRepository.update(emp, <span class="predefined-constant">true</span>);


<span class="predefined-type">Document</span> document = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)
                    .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// generates NitriteId of the document</span>
document.getId();
<span class="comment">// if filter does not find any document, it will insert 'document'</span>
WriteResult updateResult = collection.update(document, <span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Update Multiple Objects</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult update(<span class="predefined-type">Filter</span> filter, <span class="predefined-type">Document</span> update)
WriteResult update(ObjectFilter filter, T update)
WriteResult update(ObjectFilter filter, <span class="predefined-type">Document</span> update)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Updates multiple elements in the collection. If the <code>filter</code> is
<code>null</code>, it will update all objects in the collection.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Employee emp = <span class="keyword">new</span> Employee();
emp.setEmpId(<span class="integer">12564</span>);
emp.setAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">12 Some Street</span><span class="delimiter">&quot;</span></span>);
emp.setCity(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kolkata</span><span class="delimiter">&quot;</span></span>);
employeeRepository.insert(emp);

<span class="comment">// update all employees' join date whose city = Kolkata</span>
Employee empUpdate = <span class="keyword">new</span> Employee();
<span class="comment">// id field should not be set here</span>
empUpdate.setJoinDate(<span class="keyword">new</span> <span class="predefined-type">Date</span>());

<span class="comment">// if emp object is not there in repository, it will not insert</span>
employeeRepository.update(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Kolkata</span><span class="delimiter">&quot;</span></span>), empUpdate);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Update Multiple Objects with Options</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult update(<span class="predefined-type">Filter</span> filter, <span class="predefined-type">Document</span> update, UpdateOptions updateOptions)
WriteResult update(ObjectFilter filter, T update, <span class="type">boolean</span> upsert)
WriteResult update(ObjectFilter filter, <span class="predefined-type">Document</span> update, <span class="type">boolean</span> justOnce)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Updates multiple elements in the repository. Update operation can be customized
with the help of <code>updateOptions</code>. If the <code>filter</code> is <code>null</code>, it will update
all objects in the collection unless <code>justOnce</code> is set to <code>true</code> in <code>updateOptions</code>.</p>
</div>
<div class="paragraph">
<p><strong>UpdateOptions</strong></p>
</div>
<div class="paragraph">
<p>Update operation can be customized with the help of <code>updateOptions</code>. It provides two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Upsert - indicates whether the update operation will insert a new document if it
does not find any existing document to update using the <code>filter</code> (default is <code>false</code>).</p>
</li>
<li>
<p>JustOnce - indicates whether only one document will be updated or all of them if the
<code>filter</code> finds multiple documents (default is <code>false</code>).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// simple update example</span>
<span class="comment">// update the documents whose firstName = fn1 with lastName = newLastName1</span>
WriteResult updateResult = collection.update(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn1</span><span class="delimiter">&quot;</span></span>),
                createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">newLastName1</span><span class="delimiter">&quot;</span></span>));


<span class="comment">// update with update options</span>
<span class="comment">// create an update options</span>
UpdateOptions updateOptions = <span class="keyword">new</span> UpdateOptions();
updateOptions.setJustOnce(<span class="predefined-constant">true</span>);    <span class="comment">// only first document will be updated</span>
updateOptions.setUpsert(<span class="predefined-constant">false</span>);     <span class="comment">// no upsert</span>

<span class="comment">// update the document whose firstName != fn1 with lastName = newLastName1 but no upsert</span>
<span class="comment">// and it will update only 1 document</span>
<span class="predefined-type">Document</span> document = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">newLastName1</span><span class="delimiter">&quot;</span></span>);
WriteResult updateResult = collection.update(not(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn1</span><span class="delimiter">&quot;</span></span>)),
                document, updateOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Error Scenario</strong></p>
</div>
<div class="paragraph">
<p>Update operation will result in an error if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>update</code> parameter is set to <code>null</code></p>
</li>
<li>
<p>the <code>updateOptions</code> is <code>null</code></p>
</li>
<li>
<p><code>update</code> object does not have any id field for <code>update(T, boolean)</code>
and <code>update(T)</code> operations.</p>
</li>
<li>
<p><code>update</code> object has <code>null</code> value in id field for <code>update(T, boolean)</code>
and <code>update(T)</code> operations.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An update operation raises an <strong>UPDATE</strong> or <strong>INSERT</strong> event.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="remove">7.4.4. Remove</h4>
<div class="paragraph">
<p>Removes documents/objects from a collections.</p>
</div>
<div class="listingblock">
<div class="title">Remove operations for NitriteCollection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult remove(<span class="predefined-type">Document</span> element)
WriteResult remove(<span class="predefined-type">Filter</span> filter)
WriteResult remove(<span class="predefined-type">Filter</span> filter, RemoveOptions removeOptions)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Remove operations for ObjectRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WriteResult remove(T object)
WriteResult remove(ObjectFilter filter)
WriteResult remove(ObjectFilter filter, RemoveOptions removeOptions)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>filter</code> is <code>null</code>, it will remove all elements in the collection.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// removes all documents where firstName = John</span>
collection.remove(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// removes all documents</span>
collection.remove(Filters.ALL);

<span class="comment">// removes a single document</span>
collection.remove(doc);

<span class="comment">// removes all objects where firstName = John</span>
repository.remove(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>))

<span class="comment">// remove all objects</span>
repository.remove(ObjectFilters.ALL);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>RemoveOptions</strong></p>
</div>
<div class="paragraph">
<p>Remove operation can be customized by <code>removeOptions</code>. It provides
below option</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JustOnce - indicates if only one document will be removed or all
of them if <code>filter</code> finds multiple documents in the collection
(default is <code>false</code>).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RemoveOptions options = <span class="keyword">new</span> RemoveOptions();
options.setJustOne(<span class="predefined-constant">true</span>);

<span class="comment">// removes first document where firstName = John</span>
collection.remove(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>), options);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A remove operation raises an <strong>REMOVE</strong> event.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="find">7.4.5. Find</h4>
<div class="paragraph">
<p>Finds documents/objects in a collection.</p>
</div>
<div class="listingblock">
<div class="title">Find operations for NitriteCollection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Cursor</span> find()
<span class="predefined-type">Cursor</span> find(FindOptions findOptions)
<span class="predefined-type">Cursor</span> find(<span class="predefined-type">Filter</span> filter)
<span class="predefined-type">Cursor</span> find(<span class="predefined-type">Filter</span> filter, FindOptions findOptions)
<span class="predefined-type">Document</span> getById(NitriteId nitriteId);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Find operations for ObjectRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Cursor</span>&lt;T&gt; find()
<span class="predefined-type">Cursor</span>&lt;T&gt; find(FindOptions findOptions)
<span class="predefined-type">Cursor</span>&lt;T&gt; find(ObjectFilter filter)
<span class="predefined-type">Cursor</span>&lt;T&gt; find(ObjectFilter filter, FindOptions findOptions)
T getById(NitriteId nitriteId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A find operation will take advantage of an index if it exists for the field being queried.
Further details about find filters are discussed in section <a href="#filter">Filter</a>.</p>
</div>
<div class="listingblock">
<div class="title">Example for NitriteCollection</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// extracts all records from the collections</span>
<span class="predefined-type">Cursor</span> results = collection.find();

<span class="comment">// extracts paginated records from the collections</span>
<span class="predefined-type">Cursor</span> results = collection.find(FindOptions.limit(<span class="integer">0</span>, <span class="integer">1</span>));

<span class="comment">// extracts all records and sorts them based on the value of 'age' field</span>
<span class="predefined-type">Cursor</span> results = collection.find(FindOptions.sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending));

<span class="comment">// extracts all records where value of 'age' field is greater than 30</span>
<span class="predefined-type">Cursor</span> results = collection.find(Filters.gt(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));

<span class="comment">// finds all records where 'age' field value is greater than 30</span>
<span class="comment">// then sorts those records in ascending order and takes first 10 records</span>
<span class="predefined-type">Cursor</span> results = collection.find(Filters.gt(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>), FindOptions
                                        .sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending)
                                        .thenLimit(<span class="integer">0</span>, <span class="integer">10</span>));

<span class="comment">// gets a document from the collection corresponding to a NitriteId</span>
<span class="predefined-type">Document</span> document = collection.getById(id);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example for ObjectRepository</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// extracts all objects from the repository</span>
org.dizitart.no2.objects.Cursor&lt;Employee&gt; cursor = repository.find();

<span class="comment">// extracts paginated employee records from the repository</span>
<span class="predefined-type">Cursor</span>&lt;Employee&gt; cursor = repository.find(limit(<span class="integer">0</span>, <span class="integer">1</span>));

<span class="comment">// extracts all employee records and sorts them based on the value of 'age' field</span>
<span class="predefined-type">Cursor</span>&lt;Employee&gt; cursor = repository.find(sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending));

<span class="comment">// extracts all employee records where value of 'age' field is greater than 30</span>
<span class="predefined-type">Cursor</span>&lt;Employee&gt; cursor = repository.find(ObjectFilters.gt(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));

<span class="comment">// finds all employee records where 'age' field value is greater than 30</span>
<span class="comment">// then sorts those records in ascending order and takes first 10 records</span>
<span class="predefined-type">Cursor</span>&lt;Employee&gt; cursor = repository.find(ObjectFilters.gt(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>),
                                        sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending)
                                        .thenLimit(<span class="integer">0</span>, <span class="integer">10</span>));

<span class="comment">// gets a employee from the repository corresponding to a NitriteId</span>
Employee employee = repository.getById(id);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Cursor</strong></p>
</div>
<div class="paragraph">
<p>A Cursor
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/Cursor.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
is a lazy record iterator. It iterates over a database search results and fetch Document from database
on demand.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Cursor</span> cursor = collection.find();
<span class="keyword">for</span> (<span class="predefined-type">Document</span> document : cursor) {
    <span class="comment">//...</span>
}

<span class="predefined-type">Cursor</span>&lt;Employee&gt; cursor = repository.find();
<span class="keyword">for</span> (Employee employee : cursor) {
    <span class="comment">//...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Cursor is also used to project records in a different format. More in this is <a href="#projection">here</a>.</p>
</div>
<div class="paragraph">
<p><strong>FindOptions</strong></p>
</div>
<div class="paragraph">
<p>A FindOptions
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/FindOptions.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
is used to specify search options. It provides pagination as well as sorting mechanism on Cursor.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// sorts all records by age in ascending order then take first 10 records and return as a Cursor</span>
<span class="predefined-type">Cursor</span> results = collection.find(sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending).thenLimit(<span class="integer">0</span>, <span class="integer">10</span>));

<span class="comment">// sorts the records by age in ascending order</span>
<span class="predefined-type">Cursor</span> results = collection.find(sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending));

<span class="comment">// sorts the records by name in ascending order with custom collator</span>
<span class="predefined-type">Cursor</span> results = collection.find(sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending, <span class="predefined-type">Collator</span>.getInstance(<span class="predefined-type">Locale</span>.FRANCE)));

<span class="comment">// fetch 10 records starting from offset = 2</span>
<span class="predefined-type">Cursor</span> results = collection.find(limit(<span class="integer">2</span>, <span class="integer">10</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Filter Embedded Document/Object</strong></p>
</div>
<div class="paragraph">
<p>Find operation can query on embedded document/object also. Nitrite uses field separator <code>.</code> for querying
embedded object.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// find a document which contains an &quot;info&quot; embedded document with age 30</span>
<span class="predefined-type">Document</span> doc = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Doe</span><span class="delimiter">&quot;</span></span>)
     .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">info</span><span class="delimiter">&quot;</span></span>, createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));
collection.insert(doc);

<span class="predefined-type">Cursor</span> results = collection.find(Filters.eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">info.age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));


<span class="comment">// find an employee whose note contains email addresses</span>
<span class="annotation">@Data</span>
<span class="annotation">@Indices</span>({
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">employeeNote.text</span><span class="delimiter">&quot;</span></span>, type = IndexType.Fulltext)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> empId;

    <span class="directive">private</span> Note employeeNote;
}

<span class="annotation">@Data</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Note</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="predefined-type">Long</span> noteId;

    <span class="directive">private</span> <span class="predefined-type">String</span> text;
}

<span class="predefined-type">Cursor</span>&lt;Employee&gt; cursor = employeeRepository.find(regex(<span class="string"><span class="delimiter">&quot;</span><span class="content">employeeNote.text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">^[a-z0-9._%+-]+@[a-z0-9.-]+</span><span class="char">\\</span><span class="content">.[a-z]{2,6}$</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="projection">7.4.6. Projection</h4>
<div class="paragraph">
<p>Projection converts a record within a cursor from one format to another.
A projection operation can also convert the document/object within a cursor into
a sub-set of document with selected fields or another object with similar fields.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Cursor</span> cursor = collection.find(lte(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">Date</span>()),
                sort(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, SortOrder.Ascending).thenLimit(<span class="integer">0</span>, <span class="integer">3</span>));

<span class="comment">// a document with only selected field - 'firstName' and 'lastName'</span>
<span class="predefined-type">Document</span> projection = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
<span class="comment">// it will return documents containing only 'firstName' and 'lastName'</span>
RecordIterable&lt;<span class="predefined-type">Document</span>&gt; documents = cursor.project(projection);


<span class="comment">// it will return Employees containing every field that has been inserted</span>
<span class="predefined-type">Cursor</span>&lt;Employee&gt; projection = repository.find();

<span class="comment">// it will return list of SubEmployee objects containing only some fields</span>
<span class="comment">// of Employee object</span>
<span class="predefined-type">List</span>&lt;SubEmployee&gt; subEmployeeList
                = repository.find().project(SubEmployee.class).toList();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="join">7.4.7. Join</h4>
<div class="paragraph">
<p>Performs a left outer join to a collection in the same database to filter in
records from the “joined” collection. It does an equality match between a field from the
input cursor with a field from the cursor of the “joined” collection.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Document</span> doc1 = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn1</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ln1</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, simpleDateFormat.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">2012-07-01T16:02:48.440Z</span><span class="delimiter">&quot;</span></span>))
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="type">byte</span><span class="type">[]</span> {<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>})
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;() {{ add(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">two</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>); }})
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">a quick brown fox jump over the lazy dog</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Document</span> doc2 = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn2</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ln2</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, simpleDateFormat.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">2010-06-12T16:02:48.440Z</span><span class="delimiter">&quot;</span></span>))
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="type">byte</span><span class="type">[]</span> {<span class="integer">3</span>, <span class="integer">4</span>, <span class="integer">3</span>})
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;() {{ add(<span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">four</span><span class="delimiter">&quot;</span></span>); add(<span class="string"><span class="delimiter">&quot;</span><span class="content">three</span><span class="delimiter">&quot;</span></span>); }})
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">quick hello world from nitrite</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Document</span> doc3 = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn3</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ln2</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">birthDay</span><span class="delimiter">&quot;</span></span>, simpleDateFormat.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">2014-04-17T16:02:48.440Z</span><span class="delimiter">&quot;</span></span>))
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="type">byte</span><span class="type">[]</span> {<span class="integer">9</span>, <span class="integer">4</span>, <span class="integer">8</span>})
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. </span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Sed nunc mi, mattis ullamcorper dignissim vitae, condimentum non lorem.</span><span class="delimiter">&quot;</span></span>);

collection.insert(doc1, doc2, doc3);

<span class="comment">// another collection</span>

<span class="predefined-type">Document</span> fdoc1 = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">fName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn1</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ABCD Street</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">telephone</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123456789</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Document</span> fdoc2 = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">fName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn2</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">XYZ Street</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">telephone</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">000000000</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Document</span> fdoc3 = createDocument(<span class="string"><span class="delimiter">&quot;</span><span class="content">fName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">fn2</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Some other Street</span><span class="delimiter">&quot;</span></span>)
                .put(<span class="string"><span class="delimiter">&quot;</span><span class="content">telephone</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">7893141321</span><span class="delimiter">&quot;</span></span>);

foreignCollection.insert(fdoc1, fdoc2, fdoc3);

<span class="comment">// join operation</span>

Lookup lookup = <span class="keyword">new</span> Lookup();
lookup.setLocalField(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>);
lookup.setForeignField(<span class="string"><span class="delimiter">&quot;</span><span class="content">fName</span><span class="delimiter">&quot;</span></span>);
lookup.setTargetField(<span class="string"><span class="delimiter">&quot;</span><span class="content">personalDetails</span><span class="delimiter">&quot;</span></span>);

RecordIterable&lt;<span class="predefined-type">Document</span>&gt; result = collection.find().join(foreignCollection.find(), lookup);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result will look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="error">f</span><span class="error">i</span><span class="error">r</span><span class="error">s</span><span class="error">t</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">f</span><span class="error">n</span><span class="integer">1</span>,
    <span class="error">l</span><span class="error">a</span><span class="error">s</span><span class="error">t</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">l</span><span class="error">n</span><span class="integer">1</span>,
    <span class="error">b</span><span class="error">i</span><span class="error">r</span><span class="error">t</span><span class="error">h</span><span class="error">D</span><span class="error">a</span><span class="error">y</span><span class="error">=</span><span class="error">S</span><span class="error">u</span><span class="error">n</span> <span class="error">J</span><span class="error">u</span><span class="error">l</span> <span class="integer">0</span><span class="integer">1</span> <span class="integer">16</span>:<span class="integer">0</span><span class="integer">2</span>:<span class="integer">48</span>   <span class="error">I</span><span class="error">S</span><span class="error">T</span> <span class="integer">2012</span>,
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span><span class="error">=</span>   [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>],
    <span class="error">l</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">=</span>   [
         <span class="error">o</span><span class="error">n</span><span class="error">e</span>,
         <span class="error">t</span><span class="error">w</span><span class="error">o</span>,
         <span class="error">t</span><span class="error">h</span><span class="error">r</span><span class="error">e</span><span class="error">e</span>
    ],
    <span class="error">b</span><span class="error">o</span><span class="error">d</span><span class="error">y</span><span class="error">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">a quick brown fox jump over the lazy dog</span><span class="delimiter">&quot;</span></span>,
    <span class="error">_</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">9078368118890</span>,
    <span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">=</span><span class="integer">1</span>,
    <span class="error">_</span><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">d</span><span class="error">=</span><span class="integer">1510638278124</span>,
    <span class="error">p</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">D</span><span class="error">e</span><span class="error">t</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span><span class="error">=</span>      [
         {
            <span class="error">f</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">f</span><span class="error">n</span><span class="integer">1</span>,
            <span class="error">a</span><span class="error">d</span><span class="error">d</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">=</span><span class="error">A</span><span class="error">B</span><span class="error">C</span><span class="error">D</span> <span class="error">S</span><span class="error">t</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">t</span>,
            <span class="error">t</span><span class="error">e</span><span class="error">l</span><span class="error">e</span><span class="error">p</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">=</span><span class="integer">123456789</span>,
            <span class="error">_</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">9078368118887</span>,
            <span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">=</span><span class="integer">1</span>,
            <span class="error">_</span><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">d</span><span class="error">=</span><span class="integer">1510638278119</span>
         }
    ]
}

{
    <span class="error">f</span><span class="error">i</span><span class="error">r</span><span class="error">s</span><span class="error">t</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">f</span><span class="error">n</span><span class="integer">2</span>,
    <span class="error">l</span><span class="error">a</span><span class="error">s</span><span class="error">t</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">l</span><span class="error">n</span><span class="integer">2</span>,
    <span class="error">b</span><span class="error">i</span><span class="error">r</span><span class="error">t</span><span class="error">h</span><span class="error">D</span><span class="error">a</span><span class="error">y</span><span class="error">=</span><span class="error">S</span><span class="error">a</span><span class="error">t</span> <span class="error">J</span><span class="error">u</span><span class="error">n</span> <span class="integer">12</span> <span class="integer">16</span>:<span class="integer">0</span><span class="integer">2</span>:<span class="integer">48</span>   <span class="error">I</span><span class="error">S</span><span class="error">T</span> <span class="integer">2010</span>,
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span><span class="error">=</span>   [<span class="integer">3</span>, <span class="integer">4</span>, <span class="integer">3</span>],
    <span class="error">l</span><span class="error">i</span><span class="error">s</span><span class="error">t</span><span class="error">=</span>   [
         <span class="error">t</span><span class="error">h</span><span class="error">r</span><span class="error">e</span><span class="error">e</span>,
         <span class="error">f</span><span class="error">o</span><span class="error">u</span><span class="error">r</span>,
         <span class="error">t</span><span class="error">h</span><span class="error">r</span><span class="error">e</span><span class="error">e</span>
    ],
    <span class="error">b</span><span class="error">o</span><span class="error">d</span><span class="error">y</span><span class="error">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">quick hello world from nitrite</span><span class="delimiter">&quot;</span></span>,
    <span class="error">_</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">9078368118891</span>,
    <span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">=</span><span class="integer">1</span>,
    <span class="error">_</span><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">d</span><span class="error">=</span><span class="integer">1510638278130</span>,
    <span class="error">p</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">o</span><span class="error">n</span><span class="error">a</span><span class="error">l</span><span class="error">D</span><span class="error">e</span><span class="error">t</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span><span class="error">=</span>      [
         {
            <span class="error">f</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">f</span><span class="error">n</span><span class="integer">2</span>,
            <span class="error">a</span><span class="error">d</span><span class="error">d</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">=</span><span class="error">X</span><span class="error">Y</span><span class="error">Z</span> <span class="error">S</span><span class="error">t</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">t</span>,
            <span class="error">t</span><span class="error">e</span><span class="error">l</span><span class="error">e</span><span class="error">p</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">=</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span><span class="integer">0</span>,
            <span class="error">_</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">9078368118888</span>,
            <span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">=</span><span class="integer">1</span>,
            <span class="error">_</span><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">d</span><span class="error">=</span><span class="integer">1510638278123</span>
         },
         {
            <span class="error">f</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">f</span><span class="error">n</span><span class="integer">2</span>,
            <span class="error">a</span><span class="error">d</span><span class="error">d</span><span class="error">r</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">=</span><span class="error">S</span><span class="error">o</span><span class="error">m</span><span class="error">e</span> <span class="error">o</span><span class="error">t</span><span class="error">h</span><span class="error">e</span><span class="error">r</span> <span class="error">S</span><span class="error">t</span><span class="error">r</span><span class="error">e</span><span class="error">e</span><span class="error">t</span>,
            <span class="error">t</span><span class="error">e</span><span class="error">l</span><span class="error">e</span><span class="error">p</span><span class="error">h</span><span class="error">o</span><span class="error">n</span><span class="error">e</span><span class="error">=</span><span class="integer">7893141321</span>,
            <span class="error">_</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">9078368118889</span>,
            <span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">=</span><span class="integer">1</span>,
            <span class="error">_</span><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">d</span><span class="error">=</span><span class="integer">1510638278123</span>
         }
    ]
}

{
    <span class="error">f</span><span class="error">i</span><span class="error">r</span><span class="error">s</span><span class="error">t</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">f</span><span class="error">n</span><span class="integer">3</span>,
    <span class="error">l</span><span class="error">a</span><span class="error">s</span><span class="error">t</span><span class="error">N</span><span class="error">a</span><span class="error">m</span><span class="error">e</span><span class="error">=</span><span class="error">l</span><span class="error">n</span><span class="integer">2</span>,
    <span class="error">b</span><span class="error">i</span><span class="error">r</span><span class="error">t</span><span class="error">h</span><span class="error">D</span><span class="error">a</span><span class="error">y</span><span class="error">=</span><span class="error">T</span><span class="error">h</span><span class="error">u</span> <span class="error">A</span><span class="error">p</span><span class="error">r</span> <span class="integer">17</span> <span class="integer">16</span>:<span class="integer">0</span><span class="integer">2</span>:<span class="integer">48</span>   <span class="error">I</span><span class="error">S</span><span class="error">T</span> <span class="integer">2014</span>,
    <span class="error">d</span><span class="error">a</span><span class="error">t</span><span class="error">a</span><span class="error">=</span>   [ <span class="integer">9</span>, <span class="integer">4</span>, <span class="integer">8</span>],
    <span class="error">b</span><span class="error">o</span><span class="error">d</span><span class="error">y</span><span class="error">=</span><span class="string"><span class="delimiter">&quot;</span><span class="content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed nunc mi, mattis ullamcorper dignissim vitae, condimentum non lorem.</span><span class="delimiter">&quot;</span></span>,
    <span class="error">_</span><span class="error">i</span><span class="error">d</span><span class="error">=</span><span class="integer">9078368118892</span>,
    <span class="error">_</span><span class="error">r</span><span class="error">e</span><span class="error">v</span><span class="error">i</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span><span class="error">=</span><span class="integer">1</span>,
    <span class="error">_</span><span class="error">m</span><span class="error">o</span><span class="error">d</span><span class="error">i</span><span class="error">f</span><span class="error">i</span><span class="error">e</span><span class="error">d</span><span class="error">=</span><span class="integer">1510638278130</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Join operation is supported in ObjectRepository also</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">lombok.Data</span>;

<span class="annotation">@Data</span>
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Person</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
}

<span class="annotation">@Data</span>
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Address</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> personId;
    <span class="directive">private</span> <span class="predefined-type">String</span> street;
}

<span class="annotation">@Data</span>
<span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">PersonDetails</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;Address&gt; addresses;
}

Lookup lookup = <span class="keyword">new</span> Lookup();
lookup.setLocalField(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>);
lookup.setForeignField(<span class="string"><span class="delimiter">&quot;</span><span class="content">personId</span><span class="delimiter">&quot;</span></span>);
lookup.setTargetField(<span class="string"><span class="delimiter">&quot;</span><span class="content">addresses</span><span class="delimiter">&quot;</span></span>);

RecordIterable&lt;PersonDetails&gt; result
        = personRepository.find().join(addressRepository.find(), lookup,
        PersonDetails.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="events">7.5. Events</h3>
<div class="paragraph">
<p>Collections are observable by nature. Every modification to it raises
a certain event which an event listener can listen to and take appropriate
user actions if registered.</p>
</div>
<div class="paragraph">
<p>Available events are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Insert - triggered when a new element is inserted</p>
</li>
<li>
<p>Update - triggered when an element is updated</p>
</li>
<li>
<p>Remove - triggered when an element is removed</p>
</li>
<li>
<p>Drop - triggered when a collection is dropped</p>
</li>
<li>
<p>Close - triggered when a collection is closed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>EventListener &amp; ChangeInfo</strong></p>
</div>
<div class="paragraph">
<p>Every collection change can be listened to via an event listener implementation.
An event listener implementation must be registered with a collection first,
then the context information of the collection change event will be supplied to it
via a ChangeInfo
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/event/ChangeInfo.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
object.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// observe any change to a NitriteCollection</span>
collection.register(<span class="keyword">new</span> <span class="predefined-type">ChangeListener</span>() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onChange(ChangeInfo changeInfo) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Action - </span><span class="delimiter">&quot;</span></span> + changeInfo.getChangeType());
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">List of affected ids:</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (ChangedItem item : changeInfo.getChangedItems()) {
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + item.getChangeType());
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + item.getChangeTimestamp());
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + item.getDocument());
        }
    }
});

<span class="comment">// observe any change to a ObjectRepository</span>
repository.register(<span class="keyword">new</span> <span class="predefined-type">ChangeListener</span>() {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onChange(ChangeInfo changeInfo) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Action - </span><span class="delimiter">&quot;</span></span> + changeInfo.getChangeType());
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">List of affected ids:</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (ChangedItem item : changeInfo.getChangedItems()) {
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + item.getChangeType());
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + item.getChangeTimestamp());
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id - </span><span class="delimiter">&quot;</span></span> + item.getDocument());
        }
    }
});</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Event listener code always executes in a background thread in a non-blocking fashion.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="indexing">7.6. Indexing</h3>
<div class="paragraph">
<p>Indexes helps efficient execution of queries in Nitrite. Without indexes Nitrite
must scan all documents in a collection to find a matching document. If an index
exists for a field, Nitrite uses the index to limit the number of documents it must
scan.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Index can be created at any time on an empty or non-empty collection.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Indexes are stored in a NitriteMap
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/store/NitriteMap.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
which internally maintains a counted B+ tree for persistence storage.</p>
</div>
<div class="paragraph">
<p>Nitrite supports indexes on any field or sub-field of the document in a collection,
provided</p>
</div>
<div class="ulist">
<ul>
<li>
<p>field is not of array or collection type</p>
</li>
<li>
<p>field contains value of Comparable type</p>
</li>
<li>
<p>another index does not exist on the same field</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Compound index is not supported in Nitrite.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Type of Index</strong></p>
</div>
<div class="paragraph">
<p>Nitrite supports 3 kinds of index:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unique Index</p>
</li>
<li>
<p>Non-unique Index</p>
</li>
<li>
<p>Full-text Index</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Create an Index</strong></p>
</div>
<div class="paragraph">
<p>To create an index in collections use below function</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> createIndex(<span class="predefined-type">String</span> field, IndexOptions indexOptions)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Nitrite supports indexing on embedded field also</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">collection.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">info.age</span><span class="delimiter">&quot;</span></span>, indexOptions(IndexType.NonUnique, <span class="predefined-constant">true</span>));</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All indexing operation is synchronous and blocking in nature, unless
<code>IndexOptions.async</code> is set to <code>true</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Rebuild Index</strong></p>
</div>
<div class="paragraph">
<p>To rebuild a corrupted index call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> rebuildIndex(<span class="predefined-type">String</span> field, <span class="type">boolean</span> async)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Drop Index</strong></p>
</div>
<div class="paragraph">
<p>To drop index data of a specific field call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> dropIndex(<span class="predefined-type">String</span> field)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And to drop all indices of a collection call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> dropAllIndices()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Other Index Utilities</strong></p>
</div>
<div class="paragraph">
<p>To check if a field is already indexed call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> hasIndex(<span class="predefined-type">String</span> field)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check if currently indexing is running on a specific field call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> isIndexing(<span class="predefined-type">String</span> field)</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get list of all index information of a collection call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Collection</span>&lt;Index&gt; listIndices()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (!collection.hasIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>)) {
    <span class="comment">// create a on unique index on field 'firstName'</span>
    collection.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>,
                    indexOptions(IndexType.NonUnique, <span class="predefined-constant">true</span>));
}

<span class="comment">// drop index on field 'lastName'</span>
collection.dropIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// rebuild index on age asynchronously</span>
collection.rebuildIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);

<span class="comment">// print all index details of a collection</span>
<span class="keyword">for</span>(Index idx : collection.listIndices()) {
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Field = </span><span class="delimiter">&quot;</span></span> + idx.getField());
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Index Type = </span><span class="delimiter">&quot;</span></span> + idx.getIndexType());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Error Scenario</strong></p>
</div>
<div class="paragraph">
<p>Indexing operation results in an error if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>creating index of a field where already index exists</p>
</li>
<li>
<p>rebuild index of a field which is not already indexed</p>
</li>
<li>
<p>drop index of a field where indexing is already running</p>
</li>
<li>
<p>drop index of a field which is not already indexed</p>
</li>
<li>
<p>create full-text index of a field which does not contains string value</p>
</li>
<li>
<p>any field value violates unique constraints for an unique index</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="text-index">7.6.1. Text Index</h4>
<div class="paragraph">
<p>Nitrite supports text indexing on collections. It scans documents
and create index entries by decomposing texts of an indexed field. Text
indexing is supported only on the field of string data type.</p>
</div>
<div class="paragraph">
<p>Nitrite has its own text indexing engine, but a
third-party text indexing engine like lucene can also be configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Nitrite&#8217;s own text indexing engine is case insensitive by nature.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Create Text Index</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">collection.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">notes</span><span class="delimiter">&quot;</span></span>, indexOptions(IndexType.Fulltext, <span class="predefined-constant">true</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Tokenization &amp; Stemming</strong></p>
</div>
<div class="paragraph">
<p>Nitrite&#8217;s text indexing engines supports below delimiters</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">space</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\t</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">%</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&amp;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">!</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">#</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">|</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">^</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">{</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, Nitrite drops english stop words (e.g. the, an, a, and, etc.) before
creating text index entries.</p>
</div>
<div class="paragraph">
<p><strong>Universal Tokenizer</strong></p>
</div>
<div class="paragraph">
<p>Filtering stop words for other languages can also be enabled using <code>UniversalTextTokenizer</code>
from version 2.1.0 onwards.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">UniversalTextTokenizer tokenizer = <span class="keyword">new</span> UniversalTextTokenizer();
<span class="comment">// enable tokenizer for bengali, english and chinese text only</span>
tokenizer.loadLanguage(Languages.Bengali, Languages.English, Languages.Chinese);

<span class="comment">// or, enable tokenization for all supported languages (resource heavy, as it loads all stop words in memory)</span>
tokenizer.loadAllLanguages();

<span class="comment">// initialize db with the universal tokenizer</span>
Nitrite db = Nitrite.builder()
            .textTokenizer(tokenizer)
            .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
            .openOrCreate();</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Supported Languages</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Afrikaans</p>
</li>
<li>
<p>Arabic</p>
</li>
<li>
<p>Armenian</p>
</li>
<li>
<p>Basque</p>
</li>
<li>
<p>Bengali</p>
</li>
<li>
<p>Breton</p>
</li>
<li>
<p>Bulgarian</p>
</li>
<li>
<p>Catalan</p>
</li>
<li>
<p>Chinese</p>
</li>
<li>
<p>Croatian</p>
</li>
<li>
<p>Czech</p>
</li>
<li>
<p>Danish</p>
</li>
<li>
<p>Dutch</p>
</li>
<li>
<p>English</p>
</li>
<li>
<p>Esperanto</p>
</li>
<li>
<p>Estonian</p>
</li>
<li>
<p>Finnish</p>
</li>
<li>
<p>French</p>
</li>
<li>
<p>Galician</p>
</li>
<li>
<p>German</p>
</li>
<li>
<p>Greek</p>
</li>
<li>
<p>Hausa</p>
</li>
<li>
<p>Hebrew</p>
</li>
<li>
<p>Hindi</p>
</li>
<li>
<p>Hungarian</p>
</li>
<li>
<p>Indonesian</p>
</li>
<li>
<p>Irish</p>
</li>
<li>
<p>Italian</p>
</li>
<li>
<p>Japanese</p>
</li>
<li>
<p>Korean</p>
</li>
<li>
<p>Kurdish</p>
</li>
<li>
<p>Latin</p>
</li>
<li>
<p>Latvian</p>
</li>
<li>
<p>Lithuanian</p>
</li>
<li>
<p>Malay</p>
</li>
<li>
<p>Marathi</p>
</li>
<li>
<p>Norwegian</p>
</li>
<li>
<p>Persian</p>
</li>
<li>
<p>Polish</p>
</li>
<li>
<p>Portuguese</p>
</li>
<li>
<p>Romanian</p>
</li>
<li>
<p>Russian</p>
</li>
<li>
<p>Sesotho</p>
</li>
<li>
<p>Slovak</p>
</li>
<li>
<p>Slovenian</p>
</li>
<li>
<p>Somali</p>
</li>
<li>
<p>Spanish</p>
</li>
<li>
<p>Swahili</p>
</li>
<li>
<p>Swedish</p>
</li>
<li>
<p>Tagalog</p>
</li>
<li>
<p>Thai</p>
</li>
<li>
<p>Turkish</p>
</li>
<li>
<p>Ukrainian</p>
</li>
<li>
<p>Urdu</p>
</li>
<li>
<p>Vietnamese</p>
</li>
<li>
<p>Yoruba</p>
</li>
<li>
<p>Zulu</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Third-party Text Indexing Engine</strong></p>
</div>
<div class="paragraph">
<p>Nitrite&#8217;s built-in text indexing only supports english language. For
other languages a third-party text indexing engines like lucene can be
configured by implementing TextIndexingService
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/fulltext/TextIndexingService.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
interface like below</p>
</div>
<div class="listingblock">
<div class="title">Configuring Lucene based text indexing engine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/*
 *
 * Copyright 2017-2018 Nitrite author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *        http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */</span>

<span class="keyword">package</span> <span class="namespace">org.dizitart.no2.services</span>;

<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.annotation.JsonAutoDetect</span>;
<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.databind.ObjectMapper</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.Analyzer</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.analysis.standard.StandardAnalyzer</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.Document</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.Field</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.StringField</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.document.TextField</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.index</span>.*;
<span class="keyword">import</span> <span class="include">org.apache.lucene.queryparser.classic.ParseException</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.queryparser.classic.QueryParser</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.search</span>.*;
<span class="keyword">import</span> <span class="include">org.apache.lucene.store.Directory</span>;
<span class="keyword">import</span> <span class="include">org.apache.lucene.store.RAMDirectory</span>;
<span class="keyword">import</span> <span class="include">org.dizitart.no2.NitriteId</span>;
<span class="keyword">import</span> <span class="include">org.dizitart.no2.exceptions.IndexingException</span>;
<span class="keyword">import</span> <span class="include">org.dizitart.no2.fulltext.TextIndexingService</span>;

<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.LinkedHashSet</span>;
<span class="keyword">import</span> <span class="include">java.util.Set</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.dizitart.no2.exceptions.ErrorMessage.errorMessage</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.dizitart.no2.util.StringUtils.isNullOrEmpty</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">LuceneService</span> <span class="directive">implements</span> TextIndexingService {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> CONTENT_ID = <span class="string"><span class="delimiter">&quot;</span><span class="content">content_id</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_SEARCH = <span class="predefined-type">Byte</span>.MAX_VALUE;

    <span class="directive">private</span> IndexWriter indexWriter;
    <span class="directive">private</span> ObjectMapper keySerializer;
    <span class="directive">private</span> Analyzer analyzer;
    <span class="directive">private</span> Directory indexDirectory;

    <span class="directive">public</span> LuceneService() {
        <span class="keyword">try</span> {
            <span class="local-variable">this</span>.keySerializer = <span class="keyword">new</span> ObjectMapper();
            keySerializer.setVisibility(keySerializer
                .getSerializationConfig()
                .getDefaultVisibilityChecker()
                .withFieldVisibility(JsonAutoDetect.Visibility.ANY)
                .withGetterVisibility(JsonAutoDetect.Visibility.NONE)
                .withIsGetterVisibility(JsonAutoDetect.Visibility.NONE));

            indexDirectory = <span class="keyword">new</span> RAMDirectory();
            analyzer = <span class="keyword">new</span> StandardAnalyzer();

            IndexWriterConfig iwc = <span class="keyword">new</span> IndexWriterConfig(analyzer);
            iwc.setOpenMode(IndexWriterConfig.OpenMode.CREATE_OR_APPEND);
            indexWriter = <span class="keyword">new</span> IndexWriter(indexDirectory, iwc);
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not create full-text index</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>), e);
        } <span class="keyword">catch</span> (<span class="exception">VirtualMachineError</span> vme) {
            handleVirtualMachineError(vme);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> createIndex(NitriteId id, <span class="predefined-type">String</span> field, <span class="predefined-type">String</span> text) {
        <span class="keyword">try</span> {
            <span class="predefined-type">Document</span> document = <span class="keyword">new</span> <span class="predefined-type">Document</span>();
            <span class="predefined-type">String</span> jsonId = keySerializer.writeValueAsString(id);
            <span class="predefined-type">Field</span> contentField = <span class="keyword">new</span> <span class="predefined-type">TextField</span>(field, text, <span class="predefined-type">Field</span>.Store.NO);
            <span class="predefined-type">Field</span> idField = <span class="keyword">new</span> StringField(CONTENT_ID, jsonId, <span class="predefined-type">Field</span>.Store.YES);

            document.add(idField);
            document.add(contentField);

            <span class="directive">synchronized</span> (<span class="local-variable">this</span>) {
                indexWriter.addDocument(document);
            }
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not write full-text index data for </span><span class="delimiter">&quot;</span></span> + text, <span class="integer">0</span>), ioe);
        } <span class="keyword">catch</span> (<span class="exception">VirtualMachineError</span> vme) {
            handleVirtualMachineError(vme);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> updateIndex(NitriteId id, <span class="predefined-type">String</span> field, <span class="predefined-type">String</span> text) {
        <span class="keyword">try</span> {
            <span class="predefined-type">String</span> jsonId = keySerializer.writeValueAsString(id);
            <span class="predefined-type">Document</span> document = getDocument(jsonId);
            <span class="keyword">if</span> (document == <span class="predefined-constant">null</span>) {
                document = <span class="keyword">new</span> <span class="predefined-type">Document</span>();
                <span class="predefined-type">Field</span> idField = <span class="keyword">new</span> StringField(CONTENT_ID, jsonId, <span class="predefined-type">Field</span>.Store.YES);
                document.add(idField);
            }
            <span class="predefined-type">Field</span> contentField = <span class="keyword">new</span> <span class="predefined-type">TextField</span>(field, text, <span class="predefined-type">Field</span>.Store.YES);

            document.add(contentField);

            <span class="directive">synchronized</span> (<span class="local-variable">this</span>) {
                indexWriter.updateDocument(<span class="keyword">new</span> Term(CONTENT_ID, jsonId), document);
            }
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not update full-text index for </span><span class="delimiter">&quot;</span></span> + text, <span class="integer">0</span>), ioe);
        } <span class="keyword">catch</span> (<span class="exception">VirtualMachineError</span> vme) {
            handleVirtualMachineError(vme);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> deleteIndex(NitriteId id, <span class="predefined-type">String</span> field, <span class="predefined-type">String</span> text) {
        <span class="keyword">try</span> {
            <span class="predefined-type">String</span> jsonId = keySerializer.writeValueAsString(id);
            Term idTerm = <span class="keyword">new</span> Term(CONTENT_ID, jsonId);

            <span class="directive">synchronized</span> (<span class="local-variable">this</span>) {
                indexWriter.deleteDocuments(idTerm);
            }
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not remove full-text index for </span><span class="delimiter">&quot;</span></span> + id, <span class="integer">0</span>));
        } <span class="keyword">catch</span> (<span class="exception">VirtualMachineError</span> vme) {
            handleVirtualMachineError(vme);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> deleteIndexesByField(<span class="predefined-type">String</span> field) {
        <span class="keyword">if</span> (!isNullOrEmpty(field)) {
            <span class="keyword">try</span> {
                <span class="predefined-type">Query</span> query;
                QueryParser parser = <span class="keyword">new</span> QueryParser(field, analyzer);
                parser.setAllowLeadingWildcard(<span class="predefined-constant">true</span>);
                <span class="keyword">try</span> {
                    query = parser.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>);
                } <span class="keyword">catch</span> (<span class="exception">ParseException</span> e) {
                    <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not remove full-text index for value </span><span class="delimiter">&quot;</span></span> + field, <span class="integer">0</span>));
                }

                <span class="directive">synchronized</span> (<span class="local-variable">this</span>) {
                    indexWriter.deleteDocuments(query);
                }
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
                <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not remove full-text index for value </span><span class="delimiter">&quot;</span></span> + field, <span class="integer">0</span>));
            } <span class="keyword">catch</span> (<span class="exception">VirtualMachineError</span> vme) {
                handleVirtualMachineError(vme);
            }
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;NitriteId&gt; searchByIndex(<span class="predefined-type">String</span> field, <span class="predefined-type">String</span> searchString) {
        IndexReader indexReader = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span> {
            QueryParser parser = <span class="keyword">new</span> QueryParser(field, analyzer);
            parser.setAllowLeadingWildcard(<span class="predefined-constant">true</span>);
            <span class="predefined-type">Query</span> query = parser.parse(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> + searchString + <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>);

            indexReader = DirectoryReader.open(indexDirectory);
            IndexSearcher indexSearcher = <span class="keyword">new</span> IndexSearcher(indexReader);

            TopScoreDocCollector collector = TopScoreDocCollector.create(MAX_SEARCH);
            indexSearcher.search(query, collector);

            TopDocs hits = collector.topDocs(<span class="integer">0</span>, MAX_SEARCH);

            <span class="predefined-type">Set</span>&lt;NitriteId&gt; keySet = <span class="keyword">new</span> <span class="predefined-type">LinkedHashSet</span>&lt;&gt;();
            <span class="keyword">if</span> (hits != <span class="predefined-constant">null</span>) {
                ScoreDoc<span class="type">[]</span> scoreDocs = hits.scoreDocs;
                <span class="keyword">if</span> (scoreDocs != <span class="predefined-constant">null</span>) {
                    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) {
                        <span class="predefined-type">Document</span> document = indexSearcher.doc(scoreDoc.doc);
                        <span class="predefined-type">String</span> jsonId = document.get(CONTENT_ID);
                        NitriteId nitriteId = keySerializer.readValue(jsonId, NitriteId.class);
                        keySet.add(nitriteId);
                    }
                }
            }

            <span class="keyword">return</span> keySet;
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> | <span class="exception">ParseException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not search on full-text index</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>), e);
        } <span class="keyword">finally</span> {
            <span class="keyword">try</span> {
                <span class="keyword">if</span> (indexReader != <span class="predefined-constant">null</span>)
                    indexReader.close();
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ignored) {
                <span class="comment">// ignored</span>
            }
        }
    }

    <span class="directive">private</span> <span class="predefined-type">Document</span> getDocument(<span class="predefined-type">String</span> jsonId) {
        IndexReader indexReader = <span class="predefined-constant">null</span>;
        <span class="keyword">try</span> {
            Term idTerm = <span class="keyword">new</span> Term(CONTENT_ID, jsonId);

            TermQuery query = <span class="keyword">new</span> TermQuery(idTerm);

            indexReader = DirectoryReader.open(indexDirectory);
            IndexSearcher indexSearcher = <span class="keyword">new</span> IndexSearcher(indexReader);

            TopScoreDocCollector collector = TopScoreDocCollector.create(MAX_SEARCH);
            indexSearcher.search(query, collector);

            TopDocs hits = collector.topDocs(<span class="integer">0</span>, MAX_SEARCH);
            <span class="predefined-type">Document</span> document = <span class="predefined-constant">null</span>;
            <span class="keyword">if</span> (hits != <span class="predefined-constant">null</span>) {
                ScoreDoc<span class="type">[]</span> scoreDocs = hits.scoreDocs;
                <span class="keyword">if</span> (scoreDocs != <span class="predefined-constant">null</span>) {
                    <span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) {
                        document = indexSearcher.doc(scoreDoc.doc);
                    }
                }
            }

            <span class="keyword">return</span> document;
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not search on full-text index</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>), e);
        } <span class="keyword">finally</span> {
            <span class="keyword">try</span> {
                <span class="keyword">if</span> (indexReader != <span class="predefined-constant">null</span>)
                    indexReader.close();
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ignored) {
                <span class="comment">// ignored</span>
            }
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> drop() {
        <span class="keyword">try</span> {
            indexDirectory = <span class="keyword">new</span> RAMDirectory();
            analyzer = <span class="keyword">new</span> StandardAnalyzer();

            IndexWriterConfig iwc = <span class="keyword">new</span> IndexWriterConfig(analyzer);
            iwc.setOpenMode(IndexWriterConfig.OpenMode.CREATE_OR_APPEND);
            indexWriter = <span class="keyword">new</span> IndexWriter(indexDirectory, iwc);
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not drop full-text index</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>), e);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> clear() {
        <span class="keyword">try</span> {
            indexWriter.deleteAll();
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not clear full-text index</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>), e);
        }
    }

    <span class="directive">private</span> <span class="type">void</span> handleVirtualMachineError(<span class="exception">VirtualMachineError</span> vme) {
        <span class="keyword">if</span> (indexWriter != <span class="predefined-constant">null</span>) {
            <span class="keyword">try</span> {
                indexWriter.close();
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
                <span class="comment">// ignore it</span>
            }
        }
        <span class="keyword">throw</span> vme;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> commit() {
        <span class="keyword">try</span> {
            indexWriter.commit();
        } <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> IndexingException(errorMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">could not commit unsaved changes</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>), e);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> close() {
        <span class="keyword">if</span> (indexWriter != <span class="predefined-constant">null</span>) {
            <span class="keyword">try</span> {
                commit();
                indexWriter.close();
            } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
                <span class="comment">// ignore it</span>
            }
        }
    }
}

<span class="comment">// Configure third-party indexing service while opening the database</span>
Nitrite db = Nitrite.builder()
            .textIndexingService(<span class="keyword">new</span> LuceneService())
            .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
            .openOrCreate();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="index-annotations">7.6.2. Index Annotations</h4>
<div class="paragraph">
<p>For ObjectRepositories there is another alternative for configuring indices,
the object type can be annotated with the indexing formation. While creating a new
ObjectRepository, Nitrite will scan the object type for indexing information
and creates if any found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.dizitart.no2.IndexType</span>;
<span class="keyword">import</span> <span class="include">org.dizitart.no2.objects.Id</span>;
<span class="keyword">import</span> <span class="include">org.dizitart.no2.objects.Index</span>;
<span class="keyword">import</span> <span class="include">org.dizitart.no2.objects.Indices</span>;


<span class="annotation">@Indices</span>({
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">joinDate</span><span class="delimiter">&quot;</span></span>, type = IndexType.NonUnique),
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, type = IndexType.Fulltext),
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">employeeNote.text</span><span class="delimiter">&quot;</span></span>, type = IndexType.Fulltext)
})
<span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="type">long</span> empId;

    <span class="directive">private</span> <span class="predefined-type">Date</span> joinDate;

    <span class="directive">private</span> <span class="predefined-type">String</span> address;

    <span class="directive">private</span> Note employeeNote;
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Note</span> {
    <span class="annotation">@Id</span>
    <span class="directive">private</span> <span class="type">long</span> noteId;

    <span class="directive">private</span> <span class="predefined-type">String</span> text;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Index in Superclass</strong></p>
</div>
<div class="paragraph">
<p>Generally, Nitrite only scans the immediate type for index annotations, it skips
the superclass from scan. To enable the scanning in its superclass for index annotation,
a class should be marked with <code>@InheritIndices</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Indices</span>(
        <span class="annotation">@Index</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, type = IndexType.Unique)
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ParentClass</span> {
    <span class="annotation">@Id</span>
    <span class="directive">public</span> <span class="predefined-type">Long</span> id;
    <span class="directive">public</span> <span class="predefined-type">Date</span> date;
}

<span class="annotation">@InheritIndices</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChildClass</span> <span class="directive">extends</span> ParentClass {
    <span class="directive">public</span> <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="filter">8. Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Filters are the selectors in the collection&#8217;s find operation. It matches documents
in the collection depending on the criteria provided and returns a set of documents,
a.k.a Cursor.</p>
</div>
<div class="paragraph">
<p>Each filtering criteria is based on a field of a document. If the field
is indexed, the find operation takes the advantage of it and only scans
the index map for that field. But if the field is not indexed, it scans
the whole collection.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 1. Comparison Filter</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Filter</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eq(String, Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches values that are equal to a specified value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gt(String, Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches values that are greater than a specified value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GreaterEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gte(String, Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches values that are greater than or equal to a specified value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lesser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lt(String, Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches values that are less than a specified value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LesserEquals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lte(String, Object)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches values that are less than or equal to a specified value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in(String, Object[])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches any of the values specified in an array.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NotIn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">notIn(String, Object[])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches none of the values specified in an array.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 2. Logical Filters</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Filter</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not(Filter)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inverts the effect of a filter and returns results that do not match the filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Or</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">or(Filter[])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joins filters with a logical OR returns all ids of the documents that match the conditions
of either filter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">And</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">and(Filter[])</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Joins filters with a logical AND returns all ids of the documents that match the conditions
of both filters.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 3. Array Filter</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Filter</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Element Match</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elemMatch(String, Filter)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Matches documents that contain an array field with at least one element that matches
the specified filter.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<caption class="title">Table 4. Text Filters</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Filter</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text(String, String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs full-text search.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex(String, String)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selects documents where values match a specified regular expression.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All filters for NitriteCollection find() operations are listed in
<code>org.dizitart.no2.filters.Filters</code>. And same for ObjectRepository
are listed in <code>org.dizitart.no2.objects.filters.ObjectFilters</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="examples">8.1. Examples</h3>
<div class="listingblock">
<div class="title">and()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value as 30 and</span>
<span class="comment">// 'name' field has value as John Doe</span>
collection.find(and(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>), eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">or()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value as 30 or</span>
<span class="comment">// 'name' field has value as John Doe</span>
collection.find(or(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>), eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">not()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value not equals to 30</span>
collection.find(not(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>)));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">eq()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value as 30</span>
collection.find(eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gt()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value greater than 30</span>
collection.find(gt(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gte()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value greater than or equal to 30</span>
collection.find(gte(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">lt()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value less than 30</span>
collection.find(lt(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">lte()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value lesser than or equal to 30</span>
collection.find(lte(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">30</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">in()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field has value in [20, 30, 40]</span>
collection.find(in(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">20</span>, <span class="integer">30</span>, <span class="integer">40</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">notIn()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'age' field does not have value in [20, 30, 40]</span>
collection.find(notIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">20</span>, <span class="integer">30</span>, <span class="integer">40</span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">elemMatch()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents which has an array field - 'color' and the array</span>
<span class="comment">// contains a value - 'red'.</span>
collection.find(elemMatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>, eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">red</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">text()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'address' field has a word 'roads'.</span>
collection.find(text(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">roads</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// matches all documents where 'address' field has word that starts with '11A'.</span>
collection.find(text(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">11a*</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// matches all documents where 'address' field has a word that ends with 'Road'.</span>
collection.find(text(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">*road</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// matches all documents where 'address' field has a word that contains a text 'oa'.</span>
collection.find(text(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">*oa*</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// matches all documents where 'address' field has words like '11a' and 'road'.</span>
collection.find(text(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">11a road</span><span class="delimiter">&quot;</span></span>));

<span class="comment">// matches all documents where 'address' field has word 'road' and another word that start with '11a'.</span>
collection.find(text(<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">11a* road</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">regex()</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// matches all documents where 'name' value starts with 'jim' or 'joe'.</span>
collection.find(regex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">^(jim|joe).*</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replication">9. Replication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replication synchronizes one Nitrite instance with another using a Nitrite DataGate server.
Nitrite supports both-way replication.</p>
</div>
<div class="paragraph">
<p>Configuring replication is very easy in Nitrite, provided a DataGate server is already setup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// open database</span>
Nitrite db = Nitrite.builder()
                .filePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/test.db</span><span class="delimiter">&quot;</span></span>)
                .openOrCreate(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// create a collection</span>
NitriteCollection collection
                = db.getCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// connect to a DataGate server</span>
DataGateClient dataGateClient = <span class="keyword">new</span> DataGateClient(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:9898</span><span class="delimiter">&quot;</span></span>)
        .withAuth(<span class="string"><span class="delimiter">&quot;</span><span class="content">userId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>);
DataGateSyncTemplate syncTemplate
        = <span class="keyword">new</span> DataGateSyncTemplate(dataGateClient, <span class="string"><span class="delimiter">&quot;</span><span class="content">remote-collection@userId</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// create sync handle</span>
SyncHandle syncHandle = Replicator.of(db)
        .forLocal(collection)
        <span class="comment">// a DataGate sync template implementation</span>
        .withSyncTemplate(syncTemplate)
        <span class="comment">// replication attempt delay of 1 sec</span>
        .delay(timeSpan(<span class="integer">1</span>, <span class="predefined-type">TimeUnit</span>.SECONDS))
        <span class="comment">// both-way replication</span>
        .ofType(ReplicationType.BOTH_WAY)
        <span class="comment">// sync event listener</span>
        .withListener(<span class="keyword">new</span> SyncEventListener() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onSyncEvent(SyncEventData eventInfo) {

            }
        })
        .configure();

<span class="comment">// start sync in the background using handle</span>
syncHandle.startSync();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Replication is fully automatic after it is started once and runs in background thread.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The application code doesn&#8217;t have to pay attention to the details: it just knows that when
it makes changes to the local Nitrite instance they will eventually be replicated to all
other remote Nitrite instances.</p>
</div>
<div class="sect2">
<h3 id="security-2">9.1. Security</h3>
<div class="paragraph">
<p>Replication is a secured operation. There are two sets of credentials needed to
successfully perform replication.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client credential</p>
</li>
<li>
<p>The user credential</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Client credential is required to create user credentials in the DataGate server.
The user credential is required to perform several operations during the replication
life cycle. Once a user credential is created it can be used for replication.</p>
</div>
<div class="paragraph">
<p>A client credential can be created using the DataGate portal. Once it is created,
an app can use that client credential to create further users. Those users will take
part in the replication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The user credential has <strong>USER</strong> authority and a client credential has <strong>CLIENT</strong>
authority.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="synchandle">9.2. SyncHandle</h3>
<div class="paragraph">
<p>SyncHandle
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/sync/SyncHandle.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
is the handler for replication job. It can be used by the application code to control
replication in various stages of application life-cycle.</p>
</div>
<div class="paragraph">
<p><strong>Start Replication</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">syncHandle.startSync();</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Pause Replication</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">syncHandle.pauseSync();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If any replicator thread is currently running, it will not be paused but the next
iteration will be paused until it has been resumed by <code>resumeSync()</code> call.</p>
</div>
<div class="paragraph">
<p><strong>Resume Replication</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">syncHandle.resumeSync();</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Reset Local</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">syncHandle.resetLocalWithRemote(<span class="integer">0</span>, <span class="integer">100</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This operation clears local collection and downloads server data. This
operation supports pagination for downloading remote data.</p>
</div>
<div class="paragraph">
<p><strong>Reset Remote</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">syncHandle.resetRemoteWithLocal(<span class="integer">0</span>, <span class="integer">100</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This operation clears server data and uploads local collection data. This
operation supports pagination for uploading local data.</p>
</div>
<div class="paragraph">
<p><strong>Cancel Sync</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">syncHandle.cancelSync();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This operation cancels the background replicator thread.</p>
</div>
</div>
<div class="sect2">
<h3 id="algorithm">9.3. Algorithm</h3>
<div class="paragraph">
<p>Nitrite DataGate server facilitates the replication between multiple
Nitrite instances. The replication logic triggers from the client end. It
runs in a background thread at a configured interval. If the previous run is not
completed within the configured interval, the next run will be skipped.</p>
</div>
<div class="paragraph">
<p><strong>Steps</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the replication type is configured as <strong>PULL</strong>, the replicator will download
all changes from server to local and updates local collection accordingly.</p>
<div class="ulist">
<ul>
<li>
<p>It first checks if the server is online.</p>
</li>
<li>
<p>If online, it will try to acquire sync lock for server copy.</p>
</li>
<li>
<p>Once lock is acquired, it reads the last sync time stored in the metadata of local collection.</p>
</li>
<li>
<p>Gets the change feed from the server copy from last sync time.</p>
</li>
<li>
<p>Updates the local collection with the remote change feed.</p>
</li>
<li>
<p>Updates last sync time received from server and store it in local metadata.</p>
</li>
<li>
<p>Releases remote sync lock.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the replication type is configured as <strong>PUSH</strong>, the replicator will upload
all changes from local to server.</p>
<div class="ulist">
<ul>
<li>
<p>It first checks if the server is online.</p>
</li>
<li>
<p>If online, it will try to acquire sync lock for server copy.</p>
</li>
<li>
<p>Once lock is acquired, it reads the last sync time stored in the metadata of local collection.</p>
</li>
<li>
<p>Gets the change feed of local from last sync time to current time.</p>
</li>
<li>
<p>Updates the server with the local change feed.</p>
</li>
<li>
<p>Updates the last sync time metadata in local.</p>
</li>
<li>
<p>Releases remote sync lock.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the replication type is configured as <strong>BOTH_WAY</strong>, the replicator will merge
changes.</p>
<div class="ulist">
<ul>
<li>
<p>It first checks if the server is online.</p>
</li>
<li>
<p>If online, it will try to acquire sync lock for server copy.</p>
</li>
<li>
<p>Once lock is acquired, it reads the last sync time stored in the metadata of local collection.</p>
</li>
<li>
<p>Gets the change feed of both server copy and local collection from last sync time.</p>
</li>
<li>
<p>Updates the server copy with the local change feed.</p>
</li>
<li>
<p>Updates the local collection with the remote change feed.</p>
</li>
<li>
<p>Updates last sync time received from server and store it in local metadata.</p>
</li>
<li>
<p>Releases remote sync lock.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sync Lock</strong></p>
</div>
<div class="paragraph">
<p>Sync lock is a mechanism to let other replicating clients know that the
remote server is currently replicating with a client, so that others will
not attempt to change the server data until the replication is completed.</p>
</div>
<div class="paragraph">
<p>A lock is acquired by updating <strong>syncLock</strong> metadata attribute with current
epoch time in server. Every sync lock write is also associated
with an expiry time metadata by updating the <strong>expiryWait</strong> attribute.</p>
</div>
<div class="paragraph">
<p>In case if a replicating client fails to release the sync lock, another client will wait
until server&#8217;s current epoch time is greater than the value of <strong>expiryWait</strong> metadata.
After it expires the new client will acquire lock and starts replication.</p>
</div>
<div class="paragraph">
<p><strong>ChangeFeed</strong></p>
</div>
<div class="paragraph">
<p>ChangeFeed
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/sync/ChangeFeed.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
is the list of all cumulative changes in a collection (for both remote and local)
within a certain time period. Feed is obtained using the document metadata and the
remove log of a collection.</p>
</div>
<div class="paragraph">
<p>Once replication is enabled for a collection, it maintains a remove log
which keeps track of the removed documents from the local collection.
Replicator collects the deleted documents details from the remove log
for a certain time interval to create the <strong><em>removed feed</em></strong>.</p>
</div>
<div class="paragraph">
<p>Replicator uses the <strong>_created</strong> and <strong>_modified</strong> attributes of a document
to generate the <strong><em>updated feed</em></strong> and <strong><em>created feed</em></strong> of a ChangeFeed.</p>
</div>
<div class="paragraph">
<p><strong>Sync Events</strong></p>
</div>
<div class="paragraph">
<p>There are 5 different events for various life cycle stages of a replication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>STARTED</p>
</li>
<li>
<p>IN_PROGRESS</p>
</li>
<li>
<p>COMPLETED</p>
</li>
<li>
<p>CANCELED</p>
</li>
<li>
<p>STOPPED</p>
</li>
<li>
<p>REPLICATION_ERROR</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Events can be listened to via an implementation of SyncEventListener
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/sync/SyncEventListener.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
registered during configuration.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="under-the-hood">10. Under The Hood</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="nitritestore">10.1. NitriteStore</h3>
<div class="paragraph">
<p>NitriteStore
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/store/NitriteStore.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
is a storage abstraction layer of Nitrite database. Currently it uses h2 database&#8217;s
<a href="http://www.h2database.com/html/mvstore.html" target="_blank" rel="noopener">MVStore</a> as the underlying
storage implementation.</p>
</div>
<div class="paragraph">
<p>NitriteStore houses NitriteMaps in itself which are the building block of database
collections.</p>
</div>
</div>
<div class="sect2">
<h3 id="nitritemap">10.2. NitriteMap</h3>
<div class="paragraph">
<p>NitriteMap
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/store/NitriteMap.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
is a persistent key-value pair named map which is the main building block of NitriteCollection and
ObjectRepository. A NitriteMap is implemented using h2 database&#8217;s
<a href="http://www.h2database.com/html/mvstore.html#maps" target="_blank" rel="noopener">MVMap</a>.</p>
</div>
<div class="paragraph">
<p>Each NitriteMap contains metadata which are mainly used for tracking changes to the collection.
Metadata contains Attributes
<span class="icon"><a class="image" href="http://static.javadoc.io/org.dizitart/nitrite/3.4.2/org/dizitart/no2/meta/Attributes.html" target="_blank" rel="noopener"><i class="fa fa-file-code-o"></i></a></span>
like create-time, last-modified-time, last-sync-time
etc.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tools">11. Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nitrite comes with several tools for various database operations.</p>
</div>
<div class="sect2">
<h3 id="data-exchange">11.1. Data Exchange</h3>
<div class="paragraph">
<p>Nitrite has a built in data exchange tool. Data can be imported or exported as json.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Export data to a file</span>
Exporter exporter = Exporter.of(db);
exporter.exportTo(schemaFile);

<span class="comment">//Import data from the file</span>
Importer importer = Importer.of(db);
importer.importFrom(schemaFile);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>ExportOptions</strong></p>
</div>
<div class="paragraph">
<p>While exporting data, a user can choose what to export by means of <code>ExportOptions</code> class.</p>
</div>
<div class="listingblock">
<div class="title">Custom Export</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ExportOptions exportOpt = <span class="keyword">new</span> ExportOptions();
exportOpt.setExportIndices(<span class="predefined-constant">false</span>);

Exporter.of(db)
        .withOptions(exportOpt)
        .exportTo(schemaFile);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="data-format">11.1.1. Data Format</h4>
<div class="paragraph">
<p>Exchange of database data follows a specific format as described below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">$schema</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://json-schema.org/draft-04/schema#</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Nitrite Data Exchange Format</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The data format for importing and exporting data out of Nitrite database.</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">collections</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">List of all Nitrite Collections</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Name of the Collection</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">indices</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Indices</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Index</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">indexType</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Type of the Index</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Indexed field</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">collectionName</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Name of the Collection</span><span class="delimiter">&quot;</span></span>
                    }
                  },
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">indexType</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">collectionName</span><span class="delimiter">&quot;</span></span>
                  ]
                }
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>
              ]
            }
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Collection data format</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NitriteId and Document pairs</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NitriteId</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">idType</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Type of ObjectId</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">objectId</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ObjectId</span><span class="delimiter">&quot;</span></span>
                    }
                  },
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">idType</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">objectId</span><span class="delimiter">&quot;</span></span>
                  ]
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Document</span><span class="delimiter">&quot;</span></span>
                }
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>
              ]
            }
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
          <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">indices</span><span class="delimiter">&quot;</span></span>,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>
        ]
      }
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">repositories</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">List of all Object Repositories</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Type of the Object</span><span class="delimiter">&quot;</span></span>
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">indices</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Indices</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Index</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">indexType</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Type of the Index</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Indexed field</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">collectionName</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Internal name of the Object Repository</span><span class="delimiter">&quot;</span></span>
                    }
                  },
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">indexType</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">collectionName</span><span class="delimiter">&quot;</span></span>
                  ]
                }
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>
              ]
            }
          },
          <span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">array</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Repository data format</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">items</span><span class="delimiter">&quot;</span></span>: {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NitriteId and Document pairs</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">NitriteId</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">idType</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Type of ObjectId</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">objectId</span><span class="delimiter">&quot;</span></span>: {
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ObjectId</span><span class="delimiter">&quot;</span></span>
                    }
                  },
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">idType</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">objectId</span><span class="delimiter">&quot;</span></span>
                  ]
                },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Document</span><span class="delimiter">&quot;</span></span>
                }
              },
              <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
                <span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>,
                <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>
              ]
            }
          }
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
          <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">indices</span><span class="delimiter">&quot;</span></span>,
          <span class="string"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>
        ]
      }
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">required</span><span class="delimiter">&quot;</span></span>: [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">collections</span><span class="delimiter">&quot;</span></span>,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">repositories</span><span class="delimiter">&quot;</span></span>
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recovery">11.2. Recovery</h3>
<div class="paragraph">
<p>A data recovery tool also comes with Nitrite as a built-in tool to recover from a
corrupted data file. While opening a database if Nitrite finds the file is corrupted,
it uses this tool to recover from it using a last known good version of the database.</p>
</div>
<div class="paragraph">
<p>This tool can also be used from application code on-demand.</p>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Recovery.recover(dataFilePath);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="datagate">11.3. DataGate</h3>
<div class="paragraph">
<p>Nitrite DataGate is the replication server for Nitrite database. It comes as a separate product.
It is available as a binary distribution or as a docker image.</p>
</div>
<div class="paragraph">
<p>To get the latest binary distribution please visit the
<a href="https://github.com/dizitart/nitrite-database/releases">Release</a> page of Github. The docker image
is available at docker hub</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker pull dizitart/nitrite-datagate</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="paragraph">
<p>DataGate server needs a MongoDb instance to run. To configure Mongo details, edit the file
<strong>datagate.properties</strong> inside the <strong>conf</strong> directory of the binary distribution and set the below
properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># Mongo Config
datagate.mongo.host=
datagate.mongo.port=
datagate.mongo.user=
datagate.mongo.password=
datagate.mongo.database=</code></pre>
</div>
</div>
<div class="paragraph">
<p>And run the server, execute the below command from bin folder</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./datagate.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure and run the docker image, some details like MongoDb connection
needs to be provided. Create some docker file like below and build it for
the desired result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="docker">FROM dizitart/nitrite-datagate

COPY keystore.jks /

## Connection details (Replace with your own values)
ENV DATAGATE_HOST &quot;0.0.0.0&quot;
ENV DATAGATE_HTTP_PORT &quot;8080&quot;
ENV DATAGATE_HTTPS_PORT &quot;8443&quot;
ENV DATAGATE_MONITOR_PORT &quot;9090&quot;
ENV DATAGATE_KEY_STORE &quot;keystore.jks&quot;
ENV DATAGATE_KEY_PASSWORD &quot;s3cret&quot;

## Mongo connection details (Replace with your own values)
ENV DATAGATE_MONGO_HOST &quot;192.168.0.100&quot;
ENV DATAGATE_MONGO_PORT &quot;2706&quot;
ENV DATAGATE_MONGO_USER &quot;demo&quot;
ENV DATAGATE_MONGO_PASSWORD &quot;demoPass&quot;
ENV DATAGATE_MONGO_DATABASE &quot;demo&quot;

## Starts the server
RUN [&quot;chmod&quot;, &quot;+x&quot;, &quot;./datagate.sh&quot;]
ENTRYPOINT [ &quot;./datagate.sh&quot; ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the server is up and running, access the admin portal using the url</p>
</div>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>http(s)://&lt;ip&gt;:&lt;port&gt;/datagate</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="potassium-nitrite">12. Potassium Nitrite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Potassium Nitrite (KNO<sub>2</sub>) is a kotlin extension of nitrite database.
It aims to streamline the usage of nitrite with kotlin by leveraging its language
features like extension function, builders, infix functions etc.</p>
</div>
<div class="paragraph">
<p>To use potassium-nitrite in any kotlin application, just add the below dependency:</p>
</div>
<div class="paragraph">
<p><strong>Maven</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.dizitart<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>potassium-nitrite<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.4.2<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Gradle</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.dizitart:potassium-nitrite:3.4.2</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="initialization">12.1. Initialization</h3>
<div class="paragraph">
<p>Database can be initialized using builder method <code>nitrite</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// without credentials
val db = nitrite {
    file = File(fileName)       // or, path = fileName
    autoCommitBufferSize = 2048
    compress = true
    autoCompact = false
}

// with credentials
val db = nitrite(&quot;userId&quot;, &quot;password&quot;) {
    file = File(fileName)       // or, path = fileName
    autoCommitBufferSize = 2048
    compress = true
    autoCompact = false
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>NitriteCollection</code> and <code>ObjectRepository</code> can be initialized as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// add import statement
import org.dizitart.kno2.*

// Initialize a Nitrite Collection
val collection = db.getCollection(&quot;test&quot;) {
    insert(documentOf(&quot;a&quot; to 1),
            documentOf(&quot;a&quot; to 2),
            documentOf(&quot;a&quot; to 3),
            documentOf(&quot;a&quot; to 4),
            documentOf(&quot;a&quot; to 5))

    val cursor = find(limit(0, 2))
}

// Initialize an Object Repository
val repository = db.getRepository&lt;Employee&gt; {
    insert(Employee(1, &quot;red&quot;), Employee(2, &quot;yellow&quot;))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The library has some builder methods to create documents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// add import statement
import org.dizitart.kno2.*

// create empty document
val doc = emptyDocument()
val doc = documentOf()

// create a document with one pair
val doc = documentOf(&quot;a&quot; to 1)

// create a document with more pairs
val doc = documentOf(&quot;a&quot; to 1, &quot;b&quot; to 2, &quot;c&quot; to 3)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="filters">12.2. Filters</h3>
<div class="paragraph">
<p>Potassium nitrite has some convenient infix functions for creating search filters.</p>
</div>
<div class="paragraph">
<p><strong>Document Filter</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// add import statement
import org.dizitart.kno2.filters.*

// equivalent to eq(&quot;a&quot;, 1)
val cursor = find(&quot;a&quot; eq 1)

// equivalent to gt(&quot;a&quot;, 1)
val cursor = find(&quot;a&quot; gt 1)

// equivalent to gte(&quot;a&quot;, 1)
val cursor = find(&quot;a&quot; gte 1)

// equivalent to lt(&quot;a&quot;, 1)
val cursor = find(&quot;a&quot; lt 1)

// equivalent to lte(&quot;a&quot;, 1)
val cursor = find(&quot;a&quot; lte 1)

// equivalent to `in`(&quot;a&quot;, arrayOf(1, 2, 5))
val cursor = find(&quot;a&quot; within arrayOf(1, 2, 5))

// equivalent to `in`(&quot;a&quot;, 1..5)
val cursor = find(&quot;a&quot; within 1..5)

// equivalent to `in`(&quot;a&quot;, listOf(1, 2, 3))
val cursor = find(&quot;a&quot; within listOf(1, 2, 3))

// equivalent to elemMatch(&quot;a&quot;, `in`(&quot;$&quot;, 3..5))
val cursor = find(&quot;a&quot; elemMatch (&quot;$&quot; within 3..5))

// equivalent to text(&quot;a&quot;, &quot;*ipsum&quot;)
val cursor = find(&quot;a&quot; text &quot;*ipsum&quot;)

// equivalent to regex(&quot;a&quot;, &quot;[a-z]+&quot;)
val cursor = find(&quot;a&quot; regex &quot;[a-z]+&quot;)

// equivalent to and(eq(&quot;a&quot;, 1), gt(&quot;b&quot;, 2))
val cursor = find((&quot;a&quot; eq 1) and (&quot;b&quot; gt 2))

// equivalent to or(eq(&quot;a&quot;, 1), gt(&quot;b&quot;, 2))
val cursor = find((&quot;a&quot; eq 1) or (&quot;b&quot; gt 2))

// equivalent to not(&quot;a&quot; within 1..5))
val cursor = find(!(&quot;a&quot; within 1..5))</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Object Filters</strong></p>
</div>
<div class="paragraph">
<p>Infix functions for object filters only applies for simple properties of kotlin classes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// add import statement
import org.dizitart.kno2.filters.*

@Indices(Index(value = &quot;text&quot;, type = IndexType.Fulltext))
data class TestData(@Id val id: Int, val text: String, val list: List&lt;ListData&gt; = listOf())

class ListData(val name: String, val score: Int)

// equivalent to eq(&quot;id&quot;, 1)
val cursor = find(TestData::id eq 1)

// equivalent to gt(&quot;id&quot;, 1)
val cursor = find(TestData::id gt 1)

// equivalent to gte(&quot;id&quot;, 1)
val cursor = find(TestData::id gte 1)

// equivalent to lt(&quot;id&quot;, 1)
val cursor = find(TestData::id lt 1)

// equivalent to lte(&quot;id&quot;, 1)
val cursor = find(TestData::id lte 1)

// equivalent to `in`(&quot;id&quot;, 1..2)
val cursor = find(TestData::id within 1..2)

// equivalent to elemMatch(&quot;list&quot;, eq(&quot;score&quot;, 4))
val cursor = find(TestData::list elemMatch (ListData::score eq 4))

// equivalent to text(&quot;text&quot;, &quot;*u*&quot;)
val cursor = find(TestData::text text &quot;*u*&quot;)

// equivalent to regex(&quot;text&quot;, &quot;[0-9]+&quot;)
val cursor = find(TestData::text regex &quot;[0-9]+&quot;)

// equivalent to and(eq(&quot;id&quot;, 1), text(&quot;text&quot;, &quot;12345&quot;))
val cursor = find((TestData::id eq 1) and (TestData::text text &quot;12345&quot;))

// equivalent to or(eq(&quot;id&quot;, 1), text(&quot;text&quot;, &quot;12345&quot;))
val cursor = find((TestData::id eq 1) or (TestData::text text &quot;12345&quot;))

// equivalent to not(lt(&quot;id&quot;, 1))
val cursor = find(!(TestData::id lt 1))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="others">12.3. Others</h3>
<div class="paragraph">
<p>Here are some utility functions for various other capabilities</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">// export data to a file
db exportTo file

// import data from file
db importFrom file</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="kotlin-data-class">12.4. Kotlin Data Class</h3>
<div class="paragraph">
<p>The library has a build-in support for kotlin data classes via jackson-kotlin module.
This module is already registered to the default jackson mapper so that user does
not have to deal with it explicitly.</p>
</div>
</div>
<div class="sect2">
<h3 id="tips">12.5. Tips</h3>
<div class="paragraph">
<p>In Android Nitrite DB might fail if it&#8217;s being opened by two processes at the same time.
The solution to that problem is to apply the classic singleton design pattern.
The idea is to make sure only one process is accessing the DB file, and subsequent requests are using the already built Nitrite DB object
and not try to open the DB file again if it has already been opened in the same context.</p>
</div>
<div class="listingblock">
<div class="title">Example of Singleton Nitrite DB in Kotlin:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">class DBHandler {

    companion object {

        @Volatile private var INSTANCE: Nitrite? = null

        fun getDBInstance(context: Context): Nitrite {
            return INSTANCE ?: synchronized(this) {
                INSTANCE ?: buildNitriteDB(context).also { INSTANCE = it }
            }
        }

        private fun buildNitriteDB(context: Context): Nitrite {
            return Nitrite.builder()
                    .compressed()
                    .filePath(context.filesDir.path + &quot;/app.db&quot;)
                    .openOrCreate()
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.4.2<br>
Last updated 2020-06-02 20:47:45 IST
</div>
</div>
</body>
</html>